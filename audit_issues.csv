ID,Title,Severity,Files,Description,Steps to Reproduce,Recommendation,Effort,Priority,Risk
AUDIT-001,Secrets exposed in code,CRITICAL,"backend/config.env, backend/ENV_EXAMPLE.txt","Секретные ключи и пароли хранятся в открытом виде в конфигурационных файлах","1. Открыть backend/config.env\n2. Увидеть SECRET_KEY и другие секреты в открытом виде","Переместить все секреты в переменные окружения, добавить .env в .gitignore",trivial,1,CRITICAL
AUDIT-002,Input validation missing,CRITICAL,"backend/app/api/chat.py:147-294","Отсутствует валидация пользовательского ввода в чат API","1. Отправить POST /api/v1/chat/message с пустым message\n2. Отправить запрос с XSS payload","Добавить Pydantic валидацию для всех входных данных",small,1,CRITICAL
AUDIT-003,Unsafe password hashing,CRITICAL,"backend/app/services/auth_service.py:14","Используется устаревшая схема хеширования bcrypt без соли","1. Создать пользователя с паролем\n2. Проверить хеш в БД","Обновить на Argon2 с правильными параметрами",small,1,CRITICAL
AUDIT-004,No HTTPS in production,CRITICAL,"nginx.conf, docker-compose.prod.yml","Конфигурация не предусматривает обязательное использование HTTPS","1. Развернуть в продакшене\n2. Проверить доступность по HTTP","Настроить HTTPS с TLS 1.2+ и правильными cipher suites",medium,1,CRITICAL
AUDIT-005,RAG system lacks RRF,HIGH,"backend/app/services/rag_service.py:59-115","Отсутствует RRF (Reciprocal Rank Fusion) для объединения BM25 и векторного поиска","1. Выполнить поиск по запросу\n2. Проверить качество результатов","Реализовать RRF с весами для объединения результатов",medium,2,HIGH
AUDIT-006,Document chunking issues,HIGH,"backend/app/services/document_service.py:300-350","Разрезание внутри юридических ссылок, отсутствие overlap","1. Загрузить юридический документ\n2. Проверить качество чанков","Улучшить алгоритм чанкинга с учетом границ предложений",medium,2,HIGH
AUDIT-007,LoRA training problems,HIGH,"backend/app/services/lora_training_service.py:152-184","Неправильные гиперпараметры, отсутствие валидации","1. Запустить LoRA обучение\n2. Проверить метрики","Исправить конфигурацию и добавить мониторинг",large,2,HIGH
AUDIT-008,Vector DB issues,HIGH,"backend/app/services/vector_store_service.py:151-205","Неправильное преобразование расстояний, отсутствие фильтрации","1. Выполнить поиск в векторной БД\n2. Проверить релевантность","Исправить формулы сходства и добавить фильтрацию",medium,2,HIGH
AUDIT-009,No caching system,HIGH,"backend/app/api/chat.py:196-271","Каждый запрос обрабатывается заново, нет кэширования","1. Отправить одинаковые запросы\n2. Измерить время ответа","Добавить Redis кэширование для ответов",medium,3,MEDIUM
AUDIT-010,N+1 database queries,MEDIUM,"backend/app/models/user.py:41-100","N+1 запросы при получении ролей пользователя","1. Получить пользователя с ролями\n2. Проверить количество SQL запросов","Использовать joinedload для оптимизации",small,3,MEDIUM
AUDIT-011,No connection pooling,MEDIUM,"backend/app/core/database.py","Каждый запрос создает новое соединение с БД","1. Выполнить много запросов\n2. Проверить количество соединений","Настроить connection pooling",small,3,MEDIUM
AUDIT-012,Insufficient test coverage,HIGH,"backend/tests/","Покрытие составляет ~15%, отсутствуют интеграционные тесты","1. Запустить pytest --cov\n2. Проверить покрытие","Добавить unit и интеграционные тесты",large,2,HIGH
AUDIT-013,No load testing,MEDIUM,"","Нет тестов производительности","1. Настроить Locust\n2. Запустить нагрузочное тестирование","Добавить нагрузочное тестирование",medium,3,MEDIUM
AUDIT-014,Unused imports,LOW,"47 files","Множество неиспользуемых импортов","1. Запустить ruff check\n2. Проверить F401 ошибки","Автоматически исправить с ruff --fix",trivial,4,LOW
AUDIT-015,Missing type hints,MEDIUM,"Multiple files","Отсутствует типизация в большинстве функций","1. Проверить mypy\n2. Найти функции без типов","Добавить типизацию для всех публичных функций",medium,4,LOW
AUDIT-016,No docstrings,LOW,"Multiple files","Отсутствуют docstrings для функций","1. Проверить документацию\n2. Найти функции без описания","Добавить docstrings для всех публичных функций",small,4,LOW
AUDIT-017,Undefined variables,CRITICAL,"backend/app/models/user.py:70,72,95,96","Неопределенные переменные user_roles","1. Запустить приложение\n2. Проверить ошибки импорта","Исправить импорты и зависимости",small,1,CRITICAL
AUDIT-018,Bare except clauses,MEDIUM,"Multiple files","Использование bare except без указания исключений","1. Найти bare except в коде\n2. Проверить обработку ошибок","Заменить на конкретные исключения",small,3,MEDIUM
AUDIT-019,Boolean comparisons,MEDIUM,"Multiple files","Сравнения с True/False вместо прямых проверок","1. Найти == True/False в коде\n2. Проверить логику","Заменить на прямые проверки",trivial,4,LOW
AUDIT-020,F-strings without placeholders,LOW,"Multiple files","F-строки без переменных","1. Найти f"" без {} в коде\n2. Проверить использование","Заменить на обычные строки",trivial,4,LOW
AUDIT-021,Unused variables,MEDIUM,"Multiple files","Неиспользуемые локальные переменные","1. Запустить ruff check\n2. Найти F841 ошибки","Удалить неиспользуемые переменные",trivial,4,LOW
AUDIT-022,Module imports not at top,MEDIUM,"backend/main.py:347","Импорты не в начале файла","1. Проверить структуру файла\n2. Найти импорты в середине","Переместить импорты в начало",trivial,4,LOW
AUDIT-023,Missing time import,CRITICAL,"backend/app/tasks/email_tasks.py:106","Отсутствует импорт модуля time","1. Запустить email tasks\n2. Проверить ошибки","Добавить import time",trivial,1,CRITICAL
AUDIT-024,Insecure CORS configuration,MEDIUM,"backend/main.py:356-362","Слишком широкие CORS настройки","1. Проверить CORS заголовки\n2. Тестировать с разных доменов","Ограничить CORS только необходимыми доменами",small,3,MEDIUM
AUDIT-025,No rate limiting on critical endpoints,HIGH,"backend/app/api/chat.py","Отсутствует rate limiting на критических эндпоинтах","1. Отправить много запросов на /chat\n2. Проверить защиту","Добавить rate limiting с Redis",medium,2,HIGH
AUDIT-026,SQL injection potential,MEDIUM,"Multiple files","Потенциальные SQL инъекции в raw запросах","1. Проверить использование raw SQL\n2. Тестировать с malicious input","Использовать параметризованные запросы",small,3,MEDIUM
AUDIT-027,No input sanitization,MEDIUM,"Multiple files","Отсутствует санитизация пользовательского ввода","1. Отправить HTML/JS в полях\n2. Проверить обработку","Добавить санитизацию всех входных данных",small,3,MEDIUM
AUDIT-028,Weak session management,MEDIUM,"backend/app/services/auth_service.py","Слабое управление сессиями","1. Проверить JWT токены\n2. Тестировать session hijacking","Улучшить управление сессиями",medium,3,MEDIUM
AUDIT-029,No audit logging,HIGH,"Multiple files","Отсутствует аудит критических операций","1. Выполнить админские операции\n2. Проверить логи","Добавить детальное логирование",medium,2,HIGH
AUDIT-030,Insecure file uploads,MEDIUM,"backend/app/api/chat.py:470-632","Небезопасная загрузка файлов","1. Загрузить malicious файл\n2. Проверить валидацию","Добавить строгую валидацию файлов",small,3,MEDIUM
issue_id,title,description,severity,category,files,lines,reproduction_steps,fix_recommendation,test_case,effort_estimate,priority,regression_risk
C001,"Секреты в конфигурации","SECRET_KEY и ENCRYPTION_KEY требуются обязательно но нет дефолтных значений",Critical,Security,"backend/app/core/config.py","44-48","cd backend && python -c ""from app.core.config import settings""","Добавить дефолтные значения для dev окружения","pytest test_config_validation","trivial",1,low
C002,"Отсутствие валидации входных эмбеддингов","Добавление документов без валидации может привести к corrupt индексу",Critical,Data Integrity,"backend/app/services/vector_store_service.py","83-106","vector_store_service.add_document('', {}, 'test')","Добавить валидацию content и metadata","pytest test_document_validation","small",1,medium
C003,"SQL Injection через metadata","Metadata фильтры могут содержать SQL-инъекции в ChromaDB",Critical,Security,"backend/app/services/vector_store_service.py","197-228","doc.metadata = {'key': ""'; DROP TABLE--""}","Санитизация metadata перед сохранением","pytest test_metadata_injection","small",1,high
H001,"Неправильная схема чанкинга","Чанкинг по символам вместо предложений для юридических текстов",High,RAG Quality,"backend/app/core/rag_system.py","121-162","Тестировать чанкинг статьи ГК РФ","Реализовать юридический чанкинг по статьям/пунктам","pytest test_legal_chunking","medium",2,medium
H002,"BM25 и векторный поиск объединяются неправильно","Используется простое взвешивание вместо RRF",High,RAG Quality,"backend/app/services/enhanced_rag_service.py","235-260","Сравнить результаты поиска с/без RRF","Реализовать Reciprocal Rank Fusion","pytest test_rrf_ranking","medium",2,low
H003,"Chunk ID коллизии","chunk_id может повторяться при перезаписи документов",High,Data Integrity,"backend/app/core/rag_system.py","152","python scripts/check_chunk_id_collisions.py","Добавить хеш контента в ID","pytest test_chunk_uniqueness","small",2,high
H004,"Неправильная фильтрация по датам","Даты хранятся как строки сравнение может быть неточным",High,RAG Quality,"backend/app/services/vector_store_service.py","175-199","Фильтровать документы по valid_from > 2024-01-01","Хранить даты в ISO формате и правильно сравнивать","pytest test_date_filtering","small",2,low
H005,"Хардкодированные VAPID ключи","VAPID ключи захардкожены в коде",High,Security,"backend/app/api/notifications.py","29-30","grep -r ""your-vapid"" backend/","Вынести в переменные окружения","pytest test_vapid_env_vars","trivial",2,low
M001,"Отсутствие rate limiting для ML inference","Нет ограничений на количество запросов к ИИ модели",Medium,Performance,"backend/app/services/saiga_service.py","All","Отправить 1000 запросов одновременно","Добавить rate limiting для ML endpoints","locust test_ml_rate_limiting","small",3,low
M002,"Improper LoRA hyperparameters","max_seq_length=512 слишком мало target_modules неполные",Medium,ML Training,"backend/app/services/lora_training_service.py","116-137","Запустить обучение с current config","Увеличить max_seq_length до 2048 добавить k_proj o_proj","pytest test_lora_hyperparams","small",3,medium
M003,"Missing readiness gating","Модели загружаются параллельно но нет проверки готовности",Medium,Infrastructure,"backend/main.py","74-113","curl /ready сразу после старта","Добавить проверку app.state.ready в /ready endpoint","pytest test_readiness_probe","trivial",3,medium
M004,"Inefficient embeddings caching","lru_cache(maxsize=1000) для embeddings слишком мал",Medium,Performance,"backend/app/services/embeddings_service.py","111","Отправить 2000 уникальных запросов","Увеличить размер кэша до 10000","pytest test_embeddings_cache_size","trivial",3,low
L001,"Отсутствие docstrings","Многие функции не имеют docstrings",Low,Code Quality,"Multiple files","Various","Запустить pydocstyle","Добавить docstrings для всех публичных функций","pydocstyle check","medium",4,low
L002,"Print statements в продакшене","Print вместо логгера в нескольких файлах",Low,Code Quality,"backend/upload_single.py backend/app/services/lora_training_service.py","Various","grep -r ""print("" backend/","Заменить print на logger.info","pytest test_no_print_statements","trivial",4,low
L003,"Hardcoded paths","Абсолютные пути в коде",Low,Portability,"backend/app/core/security.py","329","Запустить на другой машине","Использовать относительные пути","pytest test_relative_paths","trivial",4,low

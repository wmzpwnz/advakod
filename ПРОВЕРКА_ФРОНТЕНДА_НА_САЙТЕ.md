# 🔍 ПРОВЕРКА ФРОНТЕНДА НА САЙТЕ

## ❓ Почему фронтенд может не работать на сайте?

### 1. **Неправильный API URL в продакшен билде**

Проблема: Фронтенд собран с `localhost:8000` вместо реального домена.

#### ✅ РЕШЕНИЕ:

Пересобрать фронтенд с правильными переменными окружения:

```bash
# На сервере:
cd /path/to/advakod

# Создаем .env.production для фронтенда
cat > frontend/.env.production << 'EOF'
REACT_APP_API_URL=https://advacodex.com
REACT_APP_WS_URL=wss://advacodex.com
REACT_APP_ENV=production
EOF

# Пересобираем фронтенд
cd frontend
npm run build

# Или через Docker:
docker-compose -f docker-compose.prod.yml build frontend
docker-compose -f docker-compose.prod.yml up -d frontend
```

---

## 2. **CORS проблемы**

Проблема: Backend блокирует запросы с фронтенда.

#### ✅ РЕШЕНИЕ:

На сервере в `backend/.env`:

```bash
# Добавьте ваш домен в CORS
CORS_ORIGINS=https://yourdomain.com,https://www.yourdomain.com
ENVIRONMENT=production
```

Перезапустите backend:
```bash
docker-compose -f docker-compose.prod.yml restart backend
```

---

## 3. **SSL/HTTPS проблемы**

Проблема: Mixed content (HTTPS сайт пытается обращаться к HTTP API).

#### ✅ РЕШЕНИЕ:

Убедитесь что:
- Frontend: `REACT_APP_API_URL=https://...` (НЕ http://)
- WebSocket: `REACT_APP_WS_URL=wss://...` (НЕ ws://)
- Nginx настроен на SSL

---

## 4. **Проверка текущей конфигурации**

### На сервере выполните:

```bash
# 1. Проверка backend
curl https://yourdomain.com/api/v1/health
# Должно вернуть: {"status":"healthy",...}

# 2. Проверка фронтенда
curl https://yourdomain.com
# Должно вернуть HTML страницу

# 3. Проверка CORS
curl -H "Origin: https://yourdomain.com" \
     -H "Access-Control-Request-Method: POST" \
     -H "Access-Control-Request-Headers: Content-Type" \
     -X OPTIONS https://yourdomain.com/api/v1/auth/login
# Должно вернуть CORS заголовки

# 4. Проверка логов
docker-compose -f docker-compose.prod.yml logs frontend
docker-compose -f docker-compose.prod.yml logs backend
docker-compose -f docker-compose.prod.yml logs nginx
```

---

## 5. **Быстрый фикс - пересборка фронтенда**

### Вариант А: На локальной машине

```bash
# 1. Настройте .env для продакшена
cd /Users/macbook/Desktop/advakod/frontend

# 2. Создайте .env.production
cat > .env.production << 'EOF'
REACT_APP_API_URL=https://yourdomain.com
REACT_APP_WS_URL=wss://yourdomain.com
REACT_APP_ENV=production
EOF

# 3. Пересоберите
npm run build

# 4. Скопируйте build на сервер
scp -r build/ user@server:/path/to/advakod/frontend/

# 5. На сервере перезапустите nginx
docker-compose -f docker-compose.prod.yml restart nginx
```

### Вариант Б: На сервере

```bash
# SSH на сервер
ssh user@your-server

cd /path/to/advakod

# Создайте .env.production для фронтенда
cat > frontend/.env.production << 'EOF'
REACT_APP_API_URL=https://yourdomain.com
REACT_APP_WS_URL=wss://yourdomain.com
REACT_APP_ENV=production
EOF

# Пересоберите через Docker
docker-compose -f docker-compose.prod.yml build frontend
docker-compose -f docker-compose.prod.yml up -d frontend

# Перезапустите nginx
docker-compose -f docker-compose.prod.yml restart nginx
```

---

## 6. **Проверка конфигурации api.js**

Наш исправленный `frontend/src/config/api.js` теперь использует переменные окружения:

```javascript
// ✅ ПРАВИЛЬНО - читает из .env.production при сборке
export const API_BASE_URL = process.env.REACT_APP_API_URL 
  ? `${process.env.REACT_APP_API_URL}/api/v1`
  : 'http://localhost:8000/api/v1';
```

Это значит при сборке с `.env.production` URL будет правильный!

---

## 7. **Дебаг в браузере**

Откройте сайт в браузере и проверьте:

### А) Console (F12 → Console)
```javascript
// Проверьте какой API URL использует фронтенд
console.log('API URL:', window.location.origin);
```

Ищите ошибки типа:
- `Mixed Content` - значит пытается обратиться к http вместо https
- `CORS Error` - значит backend блокирует домен
- `Failed to fetch` - значит backend недоступен

### Б) Network (F12 → Network)
- Проверьте запросы к `/api/v1/*`
- Статус 200 = ОК
- Статус 404 = путь неправильный
- Статус 403/401 = проблема с авторизацией
- Статус 500 = ошибка на backend

---

## 8. **Проверка Nginx**

На сервере проверьте nginx конфигурацию:

```bash
# Проверка конфига
docker exec advakod_nginx nginx -t

# Если ошибки, проверьте пути:
docker exec advakod_nginx cat /etc/nginx/nginx.conf | grep location

# Перезагрузка nginx
docker-compose -f docker-compose.prod.yml restart nginx
```

---

## 🎯 ПОЛНАЯ ПОСЛЕДОВАТЕЛЬНОСТЬ ДЕЙСТВИЙ

### На вашей локальной машине (advakod):

```bash
cd /Users/macbook/Desktop/advakod

# 1. Создайте production .env для фронтенда
cat > frontend/.env.production << 'EOF'
REACT_APP_API_URL=https://ВАШ_ДОМЕН.com
REACT_APP_WS_URL=wss://ВАШ_ДОМЕН.com
REACT_APP_ENV=production
EOF

# 2. Пересоберите фронтенд
cd frontend
npm run build

# 3. Проверьте что build создался
ls -la build/
```

### На сервере:

```bash
# 1. Скопируйте новый build (с локальной машины)
scp -r /Users/macbook/Desktop/advakod/frontend/build/ user@server:/path/to/advakod/frontend/

# 2. Или пересоберите на сервере:
ssh user@server
cd /path/to/advakod
docker-compose -f docker-compose.prod.yml build frontend
docker-compose -f docker-compose.prod.yml up -d frontend

# 3. Проверьте backend .env
cat backend/.env | grep CORS_ORIGINS
# Должно быть: CORS_ORIGINS=https://ваш-домен.com

# 4. Перезапустите всё
docker-compose -f docker-compose.prod.yml restart
```

---

## ✅ ЧЕКЛИСТ ПРОВЕРКИ

- [ ] Frontend собран с правильным `REACT_APP_API_URL` (https://, НЕ localhost)
- [ ] Backend `.env` содержит правильный `CORS_ORIGINS`
- [ ] Nginx перезапущен
- [ ] SSL сертификаты установлены (https работает)
- [ ] Backend отвечает: `curl https://домен/api/v1/health`
- [ ] Frontend отдается: `curl https://домен`
- [ ] В браузере нет CORS ошибок (F12 → Console)
- [ ] В Network видны успешные запросы к `/api/v1/*`

---

## 🆘 ЕСЛИ НИЧЕГО НЕ ПОМОГЛО

Отправьте мне вывод этих команд:

```bash
# На сервере:
docker-compose -f docker-compose.prod.yml ps
docker-compose -f docker-compose.prod.yml logs backend --tail=50
docker-compose -f docker-compose.prod.yml logs frontend --tail=50
docker-compose -f docker-compose.prod.yml logs nginx --tail=50

curl -I https://ваш-домен.com
curl https://ваш-домен.com/api/v1/health

# Проверка переменных окружения frontend build
grep -r "localhost" frontend/build/static/js/*.js | head -5
```

И я помогу найти проблему!


# Requirements Document: Исправление миграций базы данных

## Introduction

Система обратной связи и модерации полностью реализована на уровне кода (backend API, frontend компоненты, модели, сервисы), но **миграции базы данных не применены**. Необходимо настроить Alembic и применить миграции для создания недостающих таблиц.

## Requirements

### Requirement 1: Настройка Alembic

**User Story:** Как разработчик, я хочу иметь правильно настроенный Alembic, чтобы управлять миграциями базы данных.

#### Acceptance Criteria

1. WHEN я запускаю `alembic current` THEN система SHALL показать текущую версию миграции
2. WHEN я запускаю `alembic history` THEN система SHALL показать список всех миграций
3. IF файл `alembic.ini` отсутствует THEN система SHALL создать его с правильной конфигурацией
4. WHEN конфигурация создана THEN она SHALL указывать на правильный путь к базе данных

### Requirement 2: Применение миграций

**User Story:** Как разработчик, я хочу применить существующую миграцию `20251021_235429`, чтобы создать таблицы системы обратной связи.

#### Acceptance Criteria

1. WHEN я запускаю `alembic upgrade head` THEN система SHALL создать 6 новых таблиц
2. WHEN миграция применена THEN таблица `response_feedback` SHALL существовать
3. WHEN миграция применена THEN таблица `moderation_reviews` SHALL существовать
4. WHEN миграция применена THEN таблица `problem_categories` SHALL существовать с 8 предустановленными категориями
5. WHEN миграция применена THEN таблица `training_datasets` SHALL существовать
6. WHEN миграция применена THEN таблица `moderator_stats` SHALL существовать
7. WHEN миграция применена THEN таблица `moderation_queue` SHALL существовать

### Requirement 3: Инициализация данных

**User Story:** Как разработчик, я хочу инициализировать категории проблем, чтобы модераторы могли их использовать.

#### Acceptance Criteria

1. WHEN я запускаю `python init_feedback_system.py` THEN система SHALL проверить наличие категорий
2. IF категории отсутствуют THEN система SHALL создать 8 предустановленных категорий
3. WHEN категории созданы THEN они SHALL быть упорядочены по `display_order`
4. WHEN инициализация завершена THEN система SHALL вывести список созданных категорий

### Requirement 4: Проверка целостности

**User Story:** Как разработчик, я хочу проверить, что все таблицы созданы правильно и связи работают.

#### Acceptance Criteria

1. WHEN я проверяю таблицы THEN все 6 новых таблиц SHALL существовать
2. WHEN я проверяю foreign keys THEN связи с `chat_messages` и `users` SHALL работать
3. WHEN я проверяю индексы THEN все индексы SHALL быть созданы
4. WHEN я проверяю constraints THEN все ограничения SHALL быть активны

### Requirement 5: Обновление документации

**User Story:** Как разработчик, я хочу обновить документацию развертывания, чтобы включить шаги по применению миграций.

#### Acceptance Criteria

1. WHEN я читаю документацию THEN она SHALL содержать инструкции по настройке Alembic
2. WHEN я читаю документацию THEN она SHALL содержать команды для применения миграций
3. WHEN я читаю документацию THEN она SHALL содержать команды для инициализации данных
4. WHEN я читаю документацию THEN она SHALL содержать команды для проверки статуса миграций

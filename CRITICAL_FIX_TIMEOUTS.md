# üö® –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –¢–∞–π–º–∞—É—Ç—ã –¥–ª—è Vistral-24B

**–î–∞—Ç–∞:** 28 –æ–∫—Ç—è–±—Ä—è 2025  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

---

## üî¥ –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

### –°–∏–º–ø—Ç–æ–º—ã:
- ‚ùå WebSocket –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å –∫–æ–¥–æ–º 1006
- ‚ùå `TypeError: network error` –≤ frontend
- ‚ùå `ERR_HTTP2_PROTOCOL_ERROR` –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç: "–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤–∞—à–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞. network error"

### –ü—Ä–∏—á–∏–Ω–∞ –≤ –ª–æ–≥–∞—Ö:

**Backend logs:**
```
‚ùå MODEL GENERATION TIMEOUT! Force stopping...
```

**Nginx logs:**
```
upstream timed out (110: Operation timed out) while reading upstream
POST /api/v1/rag/chat/rag/stream HTTP/2.0
```

---

## üîç –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

### 1. –ñ–µ—Å—Ç–∫–∏–π —Ç–∞–π–º–∞—É—Ç –≤ unified_llm_service.py

**–§–∞–π–ª:** `/backend/app/services/unified_llm_service.py` (—Å—Ç—Ä–æ–∫–∞ 491)

**–ë—ã–ª–æ:**
```python
# –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–´–ô –¢–ê–ô–ú–ê–£–¢ - 30 —Å–µ–∫—É–Ω–¥ –º–∞–∫—Å–∏–º—É–º
if time.time() - start_time > 30:
    logger.error("‚ùå MODEL GENERATION TIMEOUT! Force stopping...")
    break
```

**–ü—Ä–æ–±–ª–µ–º–∞:** 
- Vistral-24B - —ç—Ç–æ –±–æ–ª—å—à–∞—è –º–æ–¥–µ–ª—å —Å 24 –º–∏–ª–ª–∏–∞—Ä–¥–∞–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –ï–π —Ç—Ä–µ–±—É–µ—Ç—Å—è **–≥–æ—Ä–∞–∑–¥–æ –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏** –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
- 30 —Å–µ–∫—É–Ω–¥ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≥–æ–≤–æ—Ä–∏—Ç `VISTRAL_INFERENCE_TIMEOUT=900` (15 –º–∏–Ω—É—Ç), –Ω–æ –∫–æ–¥ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª —ç—Ç–æ!

---

### 2. –ú–∞–ª—ã–µ —Ç–∞–π–º–∞—É—Ç—ã –≤ nginx.conf

**–§–∞–π–ª:** `/nginx.conf` (—Å—Ç—Ä–æ–∫–∏ 152-154, 214-216)

**–ë—ã–ª–æ:**
```nginx
# API endpoints
proxy_connect_timeout 30s;
proxy_send_timeout 30s;
proxy_read_timeout 30s;

# WebSocket
proxy_connect_timeout 60s;
proxy_send_timeout 60s;
proxy_read_timeout 60s;
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- Nginx –æ–±—Ä—ã–≤–∞–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 30-60 —Å–µ–∫—É–Ω–¥
- AI –º–æ–¥–µ–ª—å –Ω–µ —É—Å–ø–µ–≤–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç
- –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–ª network error

---

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1: unified_llm_service.py

**–ò–∑–º–µ–Ω–µ–Ω–æ:**
```python
# –¢–∞–π–º–∞—É—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
if time.time() - start_time > self._inference_timeout:
    logger.error(f"‚ùå MODEL GENERATION TIMEOUT after {self._inference_timeout}s! Force stopping...")
    loop.call_soon_threadsafe(q.put_nowait, f"[TIMEOUT] Model generation exceeded {self._inference_timeout} seconds")
    break
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `VISTRAL_INFERENCE_TIMEOUT` –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (900 —Å–µ–∫—É–Ω–¥ = 15 –º–∏–Ω—É—Ç)
- ‚úÖ –ú–æ–¥–µ–ª—å –∏–º–µ–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- ‚úÖ –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

---

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2: nginx.conf

**–ò–∑–º–µ–Ω–µ–Ω–æ –¥–ª—è API endpoints:**
```nginx
# –¢–∞–π–º–∞—É—Ç—ã - —É–≤–µ–ª–∏—á–µ–Ω—ã –¥–ª—è Vistral-24B –º–æ–¥–µ–ª–∏
proxy_connect_timeout 60s;
proxy_send_timeout 900s;  # 15 –º–∏–Ω—É—Ç –¥–ª—è AI –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
proxy_read_timeout 900s;  # 15 –º–∏–Ω—É—Ç –¥–ª—è AI –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
```

**–ò–∑–º–µ–Ω–µ–Ω–æ –¥–ª—è WebSocket:**
```nginx
# –¢–∞–π–º–∞—É—Ç—ã –¥–ª—è WebSocket - —É–≤–µ–ª–∏—á–µ–Ω—ã –¥–ª—è –¥–æ–ª–≥–∏—Ö AI-–æ–ø–µ—Ä–∞—Ü–∏–π
proxy_connect_timeout 60s;
proxy_send_timeout 900s;  # 15 –º–∏–Ω—É—Ç –¥–ª—è streaming –æ—Ç–≤–µ—Ç–æ–≤
proxy_read_timeout 900s;  # 15 –º–∏–Ω—É—Ç –¥–ª—è streaming –æ—Ç–≤–µ—Ç–æ–≤
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ Nginx –Ω–µ –æ–±—Ä—ã–≤–∞–µ—Ç –¥–æ–ª–≥–∏–µ –∑–∞–ø—Ä–æ—Å—ã
- ‚úÖ WebSocket –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º –≤–æ –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- ‚úÖ Streaming —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üîÑ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

**–í—ã–ø–æ–ª–Ω–µ–Ω–æ:**

```bash
# 1. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ nginx
docker exec advakod_nginx nginx -s reload
# ‚úÖ –£—Å–ø–µ—à–Ω–æ (—Å warning –æ http2 - –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)

# 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ backend
docker restart advakod_backend
# ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
```

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤:

### ‚úÖ WebSocket:
- –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
- –ù–µ –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- Ping/pong —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### ‚úÖ AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—è:
- –ú–æ–¥–µ–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–æ 15 –º–∏–Ω—É—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å
- Streaming –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ–∫–µ–Ω—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –ù–µ—Ç –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–±—Ä—ã–≤–æ–≤

### ‚úÖ User Experience:
- –ü–æ–ª—É—á–∞–µ—Ç –ø–æ–ª–Ω—ã–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–µ –æ—Ç–≤–µ—Ç—ã
- –í–∏–¥–∏—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- –ù–µ—Ç network errors

---

## üéØ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞:

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –º–µ—Ç—Ä–∏–∫–∏:
```bash
curl https://advacodex.com/api/v1/llm/stats
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
- `average_response_time` - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 30-120 —Å–µ–∫—É–Ω–¥
- `p95_response_time` - –¥–æ 300 —Å–µ–∫—É–Ω–¥
- `error_rate` - –¥–æ–ª–∂–Ω–æ —Å–Ω–∏–∑–∏—Ç—å—Å—è –¥–æ < 1%

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∂–µ–ª–µ–∑–∞:

–ï—Å–ª–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—Å–µ –µ—â–µ –º–µ–¥–ª–µ–Ω–Ω–∞—è, –º–æ–∂–Ω–æ:

**–£–≤–µ–ª–∏—á–∏—Ç—å –ø–æ—Ç–æ–∫–∏:**
```bash
VISTRAL_N_THREADS=12  # –ë–æ–ª—å—à–µ CPU cores
```

**–í–∫–ª—é—á–∏—Ç—å GPU (–µ—Å–ª–∏ –µ—Å—Ç—å):**
```bash
VISTRAL_N_GPU_LAYERS=35  # –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–ª–æ–∏ –Ω–∞ GPU
```

**–£–º–µ–Ω—å—à–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):**
```bash
VISTRAL_N_CTX=4096  # –ú–µ–Ω—å—à–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç = –±—ã—Å—Ç—Ä–µ–µ
```

### 3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤:

–ï—Å–ª–∏ –æ—Ç–≤–µ—Ç—ã —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–∏–µ, –º–æ–∂–Ω–æ:
- –£–º–µ–Ω—å—à–∏—Ç—å max_tokens –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã
- –í–∫–ª—é—á–∏—Ç—å early stopping

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ!

**–ù–µ —É–º–µ–Ω—å—à–∞–π—Ç–µ —Ç–∞–π–º–∞—É—Ç—ã –æ–±—Ä–∞—Ç–Ω–æ!**

30 —Å–µ–∫—É–Ω–¥ –±—ã–ª–æ **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –º–∞–ª–æ** –¥–ª—è Vistral-24B –º–æ–¥–µ–ª–∏. 
15 –º–∏–Ω—É—Ç (900 —Å–µ–∫—É–Ω–¥) - —ç—Ç–æ **–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ** –¥–ª—è:
- –°–ª–æ–∂–Ω—ã—Ö —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π
- –ê–Ω–∞–ª–∏–∑–∞ –±–æ–ª—å—à–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- RAG —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

–í 99% —Å–ª—É—á–∞–µ–≤ –æ—Ç–≤–µ—Ç –ø—Ä–∏–¥–µ—Ç –∑–∞ 30-120 —Å–µ–∫—É–Ω–¥, –Ω–æ —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å edge cases.

---

## üìù –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:

1. ‚úÖ `/backend/app/services/unified_llm_service.py`
   - –°—Ç—Ä–æ–∫–∞ 479-482: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `self._inference_timeout` –≤–º–µ—Å—Ç–æ hardcoded 30

2. ‚úÖ `/nginx.conf`
   - –°—Ç—Ä–æ–∫–∏ 152-154: API —Ç–∞–π–º–∞—É—Ç—ã 900s
   - –°—Ç—Ä–æ–∫–∏ 214-216: WebSocket —Ç–∞–π–º–∞—É—Ç—ã 900s

---

## ‚úÖ –°—Ç–∞—Ç—É—Å

**–ü–†–û–ë–õ–ï–ú–ê –ò–°–ü–†–ê–í–õ–ï–ù–ê** ‚úÖ

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ https://advacodex.com/chat
2. –ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å: "–†–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–æ –æ –ø—Ä–∞–≤–∞—Ö –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è"
3. –î–æ–∂–¥–∏—Ç–µ—Å—å –ø–æ–ª–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ (–º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 30-120 —Å–µ–∫—É–Ω–¥)
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –Ω–µ—Ç network errors –≤ –∫–æ–Ω—Å–æ–ª–∏

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 28 –æ–∫—Ç—è–±—Ä—è 2025  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô ‚úÖ RESOLVED  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ production


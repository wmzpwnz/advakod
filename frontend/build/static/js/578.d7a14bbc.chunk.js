"use strict";(self.webpackChunkai_lawyer_frontend=self.webpackChunkai_lawyer_frontend||[]).push([[578],{5578:(e,t,s)=>{s.r(t),s.d(t,{default:()=>Pe});var r=s(9379),n=s(5043),a=s(9463),o=s(7978),i=s(4939),c=s(516),l=s(4459),d=s(3002),m=s(614),u=s(2494),h=s(1161),x=s(7365),g=s(6210),p=s(629),y=s(5746),b=s(5016);const f=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.url=e,this.options=(0,r.A)({maxReconnectAttempts:10,reconnectDelay:1e3,maxReconnectDelay:3e4,pingInterval:3e4,pongTimeout:1e4,connectionTimeout:1e4,maxMessageSize:65536,enableHeartbeat:!0,enableAutoReconnect:!0,enableErrorRecovery:!0},t),this.ws=null,this.reconnectAttempts=0,this.isConnected=!1,this.isConnecting=!1,this.shouldReconnect=!0,this.listeners=new Map,this.pingInterval=null,this.pongTimeout=null,this.lastPong=null,this.messageQueue=[],this.maxQueueSize=100,this.connectionStats={totalConnections:0,totalReconnections:0,totalMessages:0,totalErrors:0,lastConnectedAt:null,lastDisconnectedAt:null,connectionDuration:0,averageLatency:0,errorRate:0},this.connectionState="disconnected",this.errorRecovery={consecutiveErrors:0,lastErrorTime:null,errorTypes:new Map,recoveryStrategies:new Map},this.initializeRecoveryStrategies()}initializeRecoveryStrategies(){this.errorRecovery.recoveryStrategies.set("auth_error",{maxAttempts:3,delay:5e3,action:async()=>{console.log("ResilientWebSocket: Attempting auth recovery..."),this.emit("authRecoveryNeeded")}}),this.errorRecovery.recoveryStrategies.set("network_error",{maxAttempts:5,delay:2e3,action:async()=>(console.log("ResilientWebSocket: Attempting network recovery..."),!!navigator.onLine)}),this.errorRecovery.recoveryStrategies.set("server_error",{maxAttempts:3,delay:1e4,action:async()=>(console.log("ResilientWebSocket: Attempting server error recovery..."),!0)})}async connect(){return this.isConnecting||this.isConnected?Promise.resolve():(this.isConnecting=!0,this.shouldReconnect=!0,new Promise((e,t)=>{try{console.log("ResilientWebSocket: Connecting to",this.url),this.ws=new WebSocket(this.url),this.connectionState="connecting",this.emit("stateChange",this.connectionState);const s=setTimeout(()=>{this.ws&&this.ws.readyState===WebSocket.CONNECTING&&(this.ws.close(),this.connectionState="failed",this.emit("stateChange",this.connectionState),t(new Error("Connection timeout")))},this.options.connectionTimeout);this.ws.onopen=()=>{clearTimeout(s),console.log("ResilientWebSocket: Connected successfully"),this.isConnected=!0,this.isConnecting=!1,this.reconnectAttempts=0,this.connectionState="connected",this.connectionStats.totalConnections++,this.connectionStats.lastConnectedAt=new Date,this.startPingPong(),this.flushMessageQueue(),this.emit("open"),this.emit("stateChange",this.connectionState),e()},this.ws.onmessage=e=>{try{const t=JSON.parse(e.data);if("pong"===t.type)return void this.handlePong(t);this.emit("message",t)}catch(t){console.error("ResilientWebSocket: Error parsing message:",t),this.emit("error",t)}},this.ws.onclose=e=>{clearTimeout(s),console.log("ResilientWebSocket: Connection closed:",e.code,e.reason),this.isConnected=!1,this.isConnecting=!1,this.stopPingPong(),this.connectionStats.lastDisconnectedAt=new Date,this.connectionStats.lastConnectedAt&&(this.connectionStats.connectionDuration+=this.connectionStats.lastDisconnectedAt-this.connectionStats.lastConnectedAt);const t=this.handleClose(e.code,e.reason);t&&this.shouldReconnect?(this.connectionState="reconnecting",this.connectionStats.totalReconnections++,this.emit("stateChange",this.connectionState),this.scheduleReconnect()):(this.connectionState=1e3===e.code?"disconnected":"failed",this.emit("stateChange",this.connectionState)),this.emit("close",{code:e.code,reason:e.reason,shouldReconnect:t})},this.ws.onerror=e=>{clearTimeout(s),console.error("ResilientWebSocket: Connection error:",e),this.connectionStats.totalErrors++,this.errorRecovery.consecutiveErrors++,this.errorRecovery.lastErrorTime=Date.now();const n=this.classifyError(e);this.handleErrorRecovery(n),this.isConnecting=!1,this.connectionState="failed",this.emit("stateChange",this.connectionState),this.emit("error",(0,r.A)((0,r.A)({},e),{},{type:n,recoverable:this.isErrorRecoverable(n)})),t(e)}}catch(s){this.isConnecting=!1,console.error("ResilientWebSocket: Failed to create connection:",s),t(s)}}))}disconnect(){console.log("ResilientWebSocket: Disconnecting..."),this.shouldReconnect=!1,this.stopPingPong(),this.ws&&(this.ws.close(1e3,"Client disconnect"),this.ws=null),this.isConnected=!1,this.isConnecting=!1,this.messageQueue=[]}send(e){const t="string"===typeof e?e:JSON.stringify(e);if(t.length>this.options.maxMessageSize)return console.error("ResilientWebSocket: Message too large:",t.length,"bytes"),this.emit("error",{type:"message_too_large",message:"Message exceeds maximum size",size:t.length,maxSize:this.options.maxMessageSize}),!1;if(!this.isConnected||!this.ws||this.ws.readyState!==WebSocket.OPEN)return this.queueMessage(t),!this.isConnecting&&this.shouldReconnect&&this.options.enableAutoReconnect&&(console.log("ResilientWebSocket: Connection lost, attempting to reconnect for message delivery"),this.connect().catch(e=>{console.error("ResilientWebSocket: Failed to reconnect for message delivery:",e)})),!1;try{return this.ws.send(t),this.connectionStats.totalMessages++,this.emit("messageSent",{size:t.length}),!0}catch(s){console.error("ResilientWebSocket: Error sending message:",s),this.connectionStats.totalErrors++;const e=this.classifyError(s);return this.handleErrorRecovery(e),this.queueMessage(t),this.emit("error",{type:"send_error",originalError:s,message:"Failed to send message",queued:!0}),!1}}queueMessage(e){this.messageQueue.length>=this.maxQueueSize&&this.messageQueue.shift(),this.messageQueue.push(e)}flushMessageQueue(){for(;this.messageQueue.length>0&&this.isConnected;){const t=this.messageQueue.shift();try{this.ws.send(t)}catch(e){console.error("ResilientWebSocket: Error flushing message queue:",e),this.messageQueue.unshift(t);break}}}classifyError(e){return 1008===e.code||1003===e.code?"auth_error":1011===e.code||1001===e.code?"server_error":1006!==e.code&&navigator.onLine?"unknown_error":"network_error"}isErrorRecoverable(e){return!["auth_error"].includes(e)&&this.options.enableErrorRecovery}async handleErrorRecovery(e){if(!this.options.enableErrorRecovery)return!1;const t=this.errorRecovery.recoveryStrategies.get(e);if(!t)return console.warn("ResilientWebSocket: No recovery strategy for error type: ".concat(e)),!1;const s=this.errorRecovery.errorTypes.get(e)||0;if(s>=t.maxAttempts)return console.warn("ResilientWebSocket: Max recovery attempts reached for ".concat(e)),this.emit("maxRecoveryAttemptsReached",{errorType:e,attempts:s}),!1;this.errorRecovery.errorTypes.set(e,s+1);try{if(!1!==await t.action())return console.log("ResilientWebSocket: Recovery strategy for ".concat(e," completed")),this.emit("errorRecoveryAttempt",{errorType:e,attempt:s+1}),!0}catch(r){console.error("ResilientWebSocket: Recovery strategy failed for ".concat(e,":"),r)}return!1}handleClose(e,t){const s={1008:"Authentication failed",1003:"Access denied",1011:"Server error",1006:"Connection lost",1e3:"Normal closure",1001:"Going away",1009:"Message too big"}[e]||"Unknown error";console.log("ResilientWebSocket closed: ".concat(e," - ").concat(s," (").concat(t,")"));const r=this.classifyError({code:e,reason:t});1e3!==e?(this.connectionStats.totalErrors++,this.errorRecovery.consecutiveErrors++):this.errorRecovery.consecutiveErrors=0;const n=![1008,1003].includes(e)&&this.isErrorRecoverable(r);return n&&this.handleErrorRecovery(r),n}scheduleReconnect(){if(!this.options.enableAutoReconnect)return void console.log("ResilientWebSocket: Auto-reconnect disabled");if(this.reconnectAttempts>=this.options.maxReconnectAttempts)return console.log("ResilientWebSocket: Max reconnection attempts reached"),this.connectionState="failed",this.emit("stateChange",this.connectionState),void this.emit("maxReconnectAttemptsReached",{attempts:this.reconnectAttempts,consecutiveErrors:this.errorRecovery.consecutiveErrors});if(!navigator.onLine)return console.log("ResilientWebSocket: Network offline, waiting for connection..."),void this.waitForNetworkRecovery();this.reconnectAttempts++;let e=this.options.reconnectDelay;this.errorRecovery.consecutiveErrors>3&&(e*=2);const t=Math.min(e*Math.pow(2,this.reconnectAttempts-1),this.options.maxReconnectDelay);console.log("ResilientWebSocket: Scheduling reconnect attempt ".concat(this.reconnectAttempts," in ").concat(t,"ms")),this.emit("reconnectScheduled",{attempt:this.reconnectAttempts,delay:t,consecutiveErrors:this.errorRecovery.consecutiveErrors}),setTimeout(()=>{!this.shouldReconnect||this.isConnected||this.isConnecting||this.attemptReconnect()},t)}async attemptReconnect(){try{if(!navigator.onLine)return console.log("ResilientWebSocket: Network still offline, postponing reconnect"),void this.scheduleReconnect();if(this.errorRecovery.consecutiveErrors>10)return console.warn("ResilientWebSocket: Too many consecutive errors, extending delay"),void setTimeout(()=>this.scheduleReconnect(),3e4);console.log("ResilientWebSocket: Attempting reconnect ".concat(this.reconnectAttempts,"/").concat(this.options.maxReconnectAttempts)),await this.connect(),this.errorRecovery.consecutiveErrors=0,this.errorRecovery.errorTypes.clear()}catch(e){console.error("ResilientWebSocket: Reconnection failed:",e)}}waitForNetworkRecovery(){const e=()=>{navigator.onLine&&this.shouldReconnect&&(console.log("ResilientWebSocket: Network recovered, attempting reconnect"),window.removeEventListener("online",e),this.scheduleReconnect())};window.addEventListener("online",e);const t=setInterval(()=>{navigator.onLine&&this.shouldReconnect?(clearInterval(t),window.removeEventListener("online",e),this.scheduleReconnect()):this.shouldReconnect||(clearInterval(t),window.removeEventListener("online",e))},5e3)}startPingPong(){this.stopPingPong(),this.pingInterval=setInterval(()=>{if(this.isConnected&&this.ws&&this.ws.readyState===WebSocket.OPEN){const e={type:"ping",timestamp:Date.now()};this.ws.send(JSON.stringify(e)),this.pongTimeout=setTimeout(()=>{console.warn("ResilientWebSocket: Pong timeout, reconnecting..."),this.ws.close(1006,"Pong timeout")},this.options.pongTimeout)}},this.options.pingInterval)}stopPingPong(){this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=null),this.pongTimeout&&(clearTimeout(this.pongTimeout),this.pongTimeout=null)}handlePong(e){this.pongTimeout&&(clearTimeout(this.pongTimeout),this.pongTimeout=null),this.lastPong=Date.now(),console.log("ResilientWebSocket: Pong received")}on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}off(e,t){this.listeners.has(e)&&this.listeners.get(e).delete(t)}emit(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];this.listeners.has(e)&&this.listeners.get(e).forEach(t=>{try{t(...s)}catch(r){console.error("ResilientWebSocket: Error in event listener for ".concat(e,":"),r)}})}getStatus(){return{connected:this.isConnected,connecting:this.isConnecting,readyState:this.ws?this.ws.readyState:WebSocket.CLOSED,reconnectAttempts:this.reconnectAttempts,lastPong:this.lastPong,queuedMessages:this.messageQueue.length,connectionState:this.connectionState,stats:(0,r.A)({},this.connectionStats)}}getUserFriendlyStatus(){const e={connecting:{text:"\u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435...",color:"yellow",icon:"connecting"},connected:{text:"\u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u043e",color:"green",icon:"connected"},reconnecting:{text:"\u041f\u0435\u0440\u0435\u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435...",color:"orange",icon:"reconnecting"},disconnected:{text:"\u041e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u043e",color:"gray",icon:"disconnected"},failed:{text:"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f",color:"red",icon:"error"}};return e[this.connectionState]||e.disconnected}reconnect(){console.log("ResilientWebSocket: Force reconnecting..."),this.errorRecovery.consecutiveErrors=0,this.errorRecovery.errorTypes.clear(),this.reconnectAttempts=0,this.ws&&this.ws.close(1e3,"Force reconnect"),this.shouldReconnect=!0,this.connect()}resetErrorRecovery(){console.log("ResilientWebSocket: Resetting error recovery system"),this.errorRecovery.consecutiveErrors=0,this.errorRecovery.lastErrorTime=null,this.errorRecovery.errorTypes.clear(),this.reconnectAttempts=0,this.emit("errorRecoveryReset")}checkConnectionHealth(){const e=Date.now(),t={connected:this.isConnected,connectionState:this.connectionState,consecutiveErrors:this.errorRecovery.consecutiveErrors,reconnectAttempts:this.reconnectAttempts,queuedMessages:this.messageQueue.length,lastPong:this.lastPong,timeSinceLastPong:this.lastPong?e-this.lastPong:null,networkOnline:navigator.onLine,stats:(0,r.A)({},this.connectionStats)};return t.isHealthy=this.isConnected&&this.errorRecovery.consecutiveErrors<3&&(!this.lastPong||e-this.lastPong<6e4),t.errorRate=this.connectionStats.totalMessages>0?this.connectionStats.totalErrors/this.connectionStats.totalMessages:0,t}getRecoveryRecommendations(){const e=this.checkConnectionHealth(),t=[];return navigator.onLine||t.push({type:"network",message:"\u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u043a \u0438\u043d\u0442\u0435\u0440\u043d\u0435\u0442\u0443",action:"checkNetwork"}),e.consecutiveErrors>5&&t.push({type:"errors",message:"\u0421\u043b\u0438\u0448\u043a\u043e\u043c \u043c\u043d\u043e\u0433\u043e \u043e\u0448\u0438\u0431\u043e\u043a \u043f\u043e\u0434\u0440\u044f\u0434. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443",action:"pageReload"}),e.reconnectAttempts>5&&t.push({type:"reconnect",message:"\u041c\u043d\u043e\u0436\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0435 \u043f\u043e\u043f\u044b\u0442\u043a\u0438 \u043f\u0435\u0440\u0435\u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f. \u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u0441\u0435\u0440\u0432\u0435\u0440",action:"checkServer"}),e.queuedMessages>10&&t.push({type:"queue",message:"\u041d\u0430\u043a\u043e\u043f\u0438\u043b\u043e\u0441\u044c \u043c\u043d\u043e\u0433\u043e \u043d\u0435\u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043d\u044b\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439",action:"clearQueue"}),e.errorRate>.1&&t.push({type:"errorRate",message:"\u0412\u044b\u0441\u043e\u043a\u0438\u0439 \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u043e\u0448\u0438\u0431\u043e\u043a. \u0412\u043e\u0437\u043c\u043e\u0436\u043d\u044b \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u044b \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c",action:"contactSupport"}),t}applyRecoveryRecommendation(e){switch(e){case"checkNetwork":this.waitForNetworkRecovery();break;case"pageReload":this.emit("recommendPageReload");break;case"checkServer":this.options.reconnectDelay=Math.min(2*this.options.reconnectDelay,3e4);break;case"clearQueue":this.messageQueue=[],this.emit("queueCleared");break;case"contactSupport":this.emit("contactSupportRecommended",{errorRate:this.connectionStats.totalErrors/this.connectionStats.totalMessages,totalErrors:this.connectionStats.totalErrors})}}};var v=s(4227);const w=()=>{const e=(0,n.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(window.statusNotifications)return window.statusNotifications.showError(e,t);console.error("Status notifications not available:",e)},[]),t=(0,n.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(window.statusNotifications)return window.statusNotifications.showSuccess(e,t);console.log("Success:",e)},[]),s=(0,n.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(window.statusNotifications)return window.statusNotifications.showInfo(e,t);console.info("Info:",e)},[]),r=(0,n.useCallback)(()=>{if(window.statusNotifications)return window.statusNotifications.showModelUnavailable();console.error("Model unavailable")},[]),a=(0,n.useCallback)(e=>{if(window.statusNotifications)return window.statusNotifications.removeNotification(e)},[]),o=(0,n.useCallback)(t=>e(t,{title:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f",autoHide:!1,actions:[{label:"\u041f\u0435\u0440\u0435\u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c",action:()=>window.location.reload(),primary:!0}]}),[e]),i=(0,n.useCallback)(()=>e("\u0412\u0430\u0448\u0430 \u0441\u0435\u0441\u0441\u0438\u044f \u0438\u0441\u0442\u0435\u043a\u043b\u0430",{title:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f",autoHide:!1,actions:[{label:"\u0412\u043e\u0439\u0442\u0438",action:()=>window.location.href="/login",primary:!0}]}),[e]),c=(0,n.useCallback)(()=>s("\u0413\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f \u043e\u0442\u0432\u0435\u0442\u0430 \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u043c",{duration:3e3}),[s]),l=(0,n.useCallback)(()=>e("\u041f\u0440\u0435\u0432\u044b\u0448\u0435\u043d\u043e \u0432\u0440\u0435\u043c\u044f \u043e\u0436\u0438\u0434\u0430\u043d\u0438\u044f \u043e\u0442\u0432\u0435\u0442\u0430",{title:"\u0422\u0430\u0439\u043c\u0430\u0443\u0442 \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u0438",autoHide:!1,actions:[{label:"\u041f\u043e\u043f\u0440\u043e\u0431\u043e\u0432\u0430\u0442\u044c \u0441\u043d\u043e\u0432\u0430",action:()=>window.location.reload(),primary:!0}]}),[e]);return{showError:e,showSuccess:t,showInfo:s,showModelUnavailable:r,removeNotification:a,showConnectionError:o,showAuthError:i,showGenerationStopped:c,showGenerationTimeout:l}};var j=s(6128),N=s(4830),k=s(9340),S=s(4991),A=s(5699),R=s(3677),C=s(9855),E=s(3005),_=s(579);const T=e=>{let{onSendVoiceMessage:t,onCancel:s,maxDuration:r=300}=e;const[a,o]=(0,n.useState)(!1),[i,c]=(0,n.useState)(!1),[l,d]=(0,n.useState)(0),[m,u]=(0,n.useState)(null),[h,x]=(0,n.useState)(null),[g,b]=(0,n.useState)(!1),[f,v]=(0,n.useState)(1),[w,j]=(0,n.useState)(!1),[T,I]=(0,n.useState)(null),D=(0,n.useRef)(null),P=(0,n.useRef)(null),W=(0,n.useRef)(null),M=(0,n.useRef)(null),L=(0,n.useRef)([]),{isDark:z}=(0,E.D)();(0,n.useEffect)(()=>()=>{W.current&&W.current.getTracks().forEach(e=>e.stop()),M.current&&clearInterval(M.current),h&&URL.revokeObjectURL(h)},[h]);const F=()=>{D.current&&a&&(D.current.stop(),o(!1),c(!1),clearInterval(M.current))};(0,n.useEffect)(()=>{const e=P.current;if(!e)return;const t=()=>b(!1),s=()=>b(!0),r=()=>b(!1);return e.addEventListener("ended",t),e.addEventListener("play",s),e.addEventListener("pause",r),()=>{e.removeEventListener("ended",t),e.removeEventListener("play",s),e.removeEventListener("pause",r)}},[h]);const H=e=>{const t=Math.floor(e/60),s=e%60;return"".concat(t,":").concat(s.toString().padStart(2,"0"))};return(0,_.jsxs)("div",{className:"p-4 ".concat(z?"bg-gray-800":"bg-white"," rounded-lg border border-gray-200 dark:border-gray-700 shadow-lg"),children:[T&&(0,_.jsx)("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg",children:(0,_.jsx)("p",{className:"text-sm text-red-700 dark:text-red-300",children:T})}),h&&(0,_.jsx)("audio",{ref:P,src:h,volume:w?0:f,onVolumeChange:e=>v(e.target.volume)}),a&&(0,_.jsxs)("div",{className:"mb-4 flex items-center justify-center space-x-2",children:[(0,_.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,_.jsx)("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),(0,_.jsx)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:i?"\u041f\u0430\u0443\u0437\u0430":"\u0417\u0430\u043f\u0438\u0441\u044c"})]}),(0,_.jsx)("div",{className:"text-lg font-mono text-gray-900 dark:text-gray-100",children:H(l)})]}),a&&(0,_.jsx)("div",{className:"mb-4 flex items-center justify-center space-x-1",children:[...Array(20)].map((e,t)=>(0,_.jsx)("div",{className:"w-1 bg-primary-500 rounded-full animate-pulse",style:{height:"".concat(20*Math.random()+10,"px"),animationDelay:"".concat(.1*t,"s")}},t))}),(0,_.jsxs)("div",{className:"flex items-center justify-center space-x-4",children:[!a&&!m&&(0,_.jsx)("button",{onClick:async()=>{if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||(I("\u0412\u0430\u0448 \u0431\u0440\u0430\u0443\u0437\u0435\u0440 \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 \u0437\u0430\u043f\u0438\u0441\u044c \u0430\u0443\u0434\u0438\u043e"),0))try{I(null);const e=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,sampleRate:44100}});W.current=e;const t=new MediaRecorder(e,{mimeType:"audio/webm;codecs=opus"});D.current=t,L.current=[],t.ondataavailable=e=>{e.data.size>0&&L.current.push(e.data)},t.onstop=()=>{const t=new Blob(L.current,{type:"audio/webm"});u(t);const s=URL.createObjectURL(t);x(s),e.getTracks().forEach(e=>e.stop())},t.start(100),o(!0),d(0),M.current=setInterval(()=>{d(e=>e>=r?(F(),r):e+1)},1e3)}catch(e){console.error("Error starting recording:",e),I("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043d\u0430\u0447\u0430\u0442\u044c \u0437\u0430\u043f\u0438\u0441\u044c. \u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u044f \u043c\u0438\u043a\u0440\u043e\u0444\u043e\u043d\u0430.")}},className:"p-3 bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors duration-200 shadow-lg",title:"\u041d\u0430\u0447\u0430\u0442\u044c \u0437\u0430\u043f\u0438\u0441\u044c",children:(0,_.jsx)(p.A,{className:"h-6 w-6"})}),a&&(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)("button",{onClick:()=>{D.current&&(i?(D.current.resume(),c(!1),M.current=setInterval(()=>{d(e=>e>=r?(F(),r):e+1)},1e3)):(D.current.pause(),c(!0),clearInterval(M.current)))},className:"p-3 bg-yellow-500 hover:bg-yellow-600 text-white rounded-full transition-colors duration-200",title:i?"\u0412\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0437\u0430\u043f\u0438\u0441\u044c":"\u041f\u0430\u0443\u0437\u0430",children:i?(0,_.jsx)(N.A,{className:"h-6 w-6"}):(0,_.jsx)(k.A,{className:"h-6 w-6"})}),(0,_.jsx)("button",{onClick:F,className:"p-3 bg-gray-500 hover:bg-gray-600 text-white rounded-full transition-colors duration-200",title:"\u041e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0437\u0430\u043f\u0438\u0441\u044c",children:(0,_.jsx)(S.A,{className:"h-6 w-6"})})]}),m&&(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)("button",{onClick:()=>{P.current&&h&&(g?(P.current.pause(),b(!1)):(P.current.play(),b(!0)))},className:"p-3 bg-blue-500 hover:bg-blue-600 text-white rounded-full transition-colors duration-200",title:g?"\u041f\u0430\u0443\u0437\u0430":"\u0412\u043e\u0441\u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0441\u0442\u0438",children:g?(0,_.jsx)(k.A,{className:"h-6 w-6"}):(0,_.jsx)(N.A,{className:"h-6 w-6"})}),(0,_.jsx)("button",{onClick:()=>j(!w),className:"p-3 bg-gray-500 hover:bg-gray-600 text-white rounded-full transition-colors duration-200",title:w?"\u0412\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0437\u0432\u0443\u043a":"\u0412\u044b\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0437\u0432\u0443\u043a",children:w?(0,_.jsx)(A.A,{className:"h-6 w-6"}):(0,_.jsx)(R.A,{className:"h-6 w-6"})}),(0,_.jsx)("button",{onClick:()=>{m&&t&&(t(m,l),u(null),x(null),d(0),h&&URL.revokeObjectURL(h))},className:"p-3 bg-green-500 hover:bg-green-600 text-white rounded-full transition-colors duration-200",title:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0433\u043e\u043b\u043e\u0441\u043e\u0432\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",children:(0,_.jsx)(y.A,{className:"h-6 w-6"})}),(0,_.jsx)("button",{onClick:()=>{F(),u(null),x(null),d(0),h&&URL.revokeObjectURL(h),s&&s()},className:"p-3 bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors duration-200",title:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0437\u0430\u043f\u0438\u0441\u044c",children:(0,_.jsx)(C.A,{className:"h-6 w-6"})})]})]}),m&&(0,_.jsx)("div",{className:"mt-4 text-center",children:(0,_.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["\u0414\u043b\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c: ",H(l)," | \u0420\u0430\u0437\u043c\u0435\u0440: ",(m.size/1024).toFixed(1)," KB"]})}),a&&(0,_.jsxs)("div",{className:"mt-4",children:[(0,_.jsx)("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:(0,_.jsx)("div",{className:"bg-primary-500 h-2 rounded-full transition-all duration-1000",style:{width:"".concat(l/r*100,"%")}})}),(0,_.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 text-center",children:["\u041c\u0430\u043a\u0441\u0438\u043c\u0443\u043c: ",H(r)]})]})]})};var I=s(8326),D=s(1360),P=s(4669),W=s(5088),M=s(4596),L=s(9292),z=s(8646),F=s(8784),H=s(9722);const O=e=>{let{currentSessionId:t,onSessionSelect:s,onNewChat:o,isCollapsed:i,onToggleCollapse:c,focusSearch:l=!1,hideHeader:d=!1}=e;const[u,h]=(0,n.useState)([]),[x,p]=(0,n.useState)(!0),[y,b]=(0,n.useState)(null),[f,w]=(0,n.useState)(null),[j,N]=(0,n.useState)(""),[k,S]=(0,n.useState)(!1),[A,R]=(0,n.useState)(""),[E,T]=(0,n.useState)([]),[O,U]=(0,n.useState)(!1),[q,Q]=(0,n.useState)({}),G=n.useRef(null),B=(0,n.useCallback)(async()=>{try{p(!0);const e=await H.A.get((0,v.e9)("/chat/sessions"),{params:{include_empty:k}}),t=(e.data||[]).sort((e,t)=>{const s=new Date(e.updated_at||e.created_at);return new Date(t.updated_at||t.created_at)-s});h(t),b(null)}catch(e){console.error("Error loading sessions:",e),b("\u041e\u0448\u0438\u0431\u043a\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0438\u0441\u0442\u043e\u0440\u0438\u0438 \u0447\u0430\u0442\u043e\u0432")}finally{p(!1)}},[k]);(0,n.useEffect)(()=>{B()},[B,k]);const V=async()=>{try{const e=(await H.A.post((0,v.e9)("/chat/sessions"),{title:"\u041d\u043e\u0432\u044b\u0439 \u0447\u0430\u0442 ".concat((new Date).toLocaleDateString("ru-RU"))})).data;h(t=>[e,...t]),o(e.id)}catch(e){console.error("Error creating new session:",e),b("\u041e\u0448\u0438\u0431\u043a\u0430 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u043d\u043e\u0432\u043e\u0433\u043e \u0447\u0430\u0442\u0430")}},J=async e=>{try{await H.A.put((0,v.e9)("/chat/sessions/".concat(e)),{title:j.trim()||"\u0411\u0435\u0437 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f"}),h(t=>t.map(t=>t.id===e?(0,r.A)((0,r.A)({},t),{},{title:j.trim()||"\u0411\u0435\u0437 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f"}):t)),w(null),N("")}catch(t){console.error("Error updating session title:",t),b("\u041e\u0448\u0438\u0431\u043a\u0430 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f")}},K=()=>{w(null),N("")},Z=e=>{const t=new Date(e),s=new Date,r=Math.floor((s-t)/864e5);return 0===r?t.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}):1===r?"\u0412\u0447\u0435\u0440\u0430":r<7?"".concat(r," \u0434\u043d. \u043d\u0430\u0437\u0430\u0434"):t.toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit"})},X=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25;return e?e.length>t?e.substring(0,t)+"...":e:"\u0411\u0435\u0437 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f"},Y=(0,n.useCallback)(async e=>{if(!e.trim())return T([]),void U(!1);U(!0);const t=e.toLowerCase().trim(),s=[];try{const e=u.filter(e=>e.title&&e.title.toLowerCase().includes(t));for(const t of e)s.push({sessionId:t.id,sessionTitle:t.title,matchType:"title",matchText:t.title});for(const a of u)if(!e.find(e=>e.id===a.id))try{let e=q[a.id];if(!e){const t=await H.A.get((0,v.e9)("/chat/sessions/".concat(a.id,"/messages")));e=t.data||[],Q(t=>(0,r.A)((0,r.A)({},t),{},{[a.id]:e}))}const n=e.filter(e=>e.content&&e.content.toLowerCase().includes(t));n.length>0&&s.push({sessionId:a.id,sessionTitle:a.title,matchType:"message",matchText:n[0].content.substring(0,100),matchCount:n.length})}catch(n){console.error("Error loading messages for session ".concat(a.id,":"),n)}T(s)}catch(n){console.error("Error searching history:",n),b("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u0438\u0441\u043a\u0430 \u043f\u043e \u0438\u0441\u0442\u043e\u0440\u0438\u0438")}finally{U(!1)}},[u,q]);(0,n.useEffect)(()=>{const e=setTimeout(()=>{Y(A)},300);return()=>clearTimeout(e)},[A,Y]),(0,n.useEffect)(()=>{if(l&&!i&&G.current){const e=setTimeout(()=>{var e;null===(e=G.current)||void 0===e||e.focus()},300);return()=>clearTimeout(e)}},[l,i]);const $=(0,n.useMemo)(()=>{if(!A.trim())return u;const e=new Set(E.map(e=>e.sessionId));return u.filter(t=>e.has(t.id))},[u,A,E]);return x?(0,_.jsx)("div",{className:"bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 transition-all duration-300 ".concat(i?"w-16":"w-80"),children:(0,_.jsx)("div",{className:"p-4 flex items-center justify-center",children:(0,_.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600"})})}):(0,_.jsxs)("div",{className:"h-full bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 transition-all duration-300 flex flex-col ".concat(i?"w-16":"w-80"),children:[!d&&(0,_.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,_.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[!i&&(0,_.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"\u0418\u0441\u0442\u043e\u0440\u0438\u044f \u0447\u0430\u0442\u043e\u0432"}),(0,_.jsx)("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),c&&"function"===typeof c&&c()},className:"p-2 min-w-[44px] min-h-[44px] text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all duration-200 flex items-center justify-center touch-manipulation",title:i?"\u0420\u0430\u0437\u0432\u0435\u0440\u043d\u0443\u0442\u044c":"\u0421\u0432\u0435\u0440\u043d\u0443\u0442\u044c","aria-label":i?"\u0420\u0430\u0437\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u0438\u0441\u0442\u043e\u0440\u0438\u044e":"\u0421\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u0438\u0441\u0442\u043e\u0440\u0438\u044e",type:"button",children:i?(0,_.jsx)(I.A,{className:"h-5 w-5"}):(0,_.jsx)(a.A,{className:"h-5 w-5"})})]}),(0,_.jsx)("button",{onClick:V,className:"w-full btn-glass-primary font-semibold rounded-xl transition-all duration-300 ".concat(i?"p-3":"py-3 px-4"),children:(0,_.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,_.jsx)(D.A,{className:"".concat("h-5 w-5")}),!i&&(0,_.jsx)("span",{children:"\u041d\u043e\u0432\u044b\u0439 \u0447\u0430\u0442"})]})})]}),(0,_.jsxs)("div",{className:"flex-1 overflow-y-auto overflow-x-hidden min-h-0",children:[y&&(0,_.jsx)("div",{className:"p-4",children:(0,_.jsx)("div",{className:"bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg p-3 text-sm text-red-600 dark:text-red-400",children:y})}),0!==u.length||x||y?(0,_.jsx)("div",{className:"p-2 space-y-1",children:$.map(e=>{const r=E.find(t=>t.sessionId===e.id);return(0,_.jsxs)("div",{className:"group relative rounded-lg transition-all duration-200 ".concat(e.id===t?"bg-primary-100 dark:bg-primary-900/50 border border-primary-200 dark:border-primary-800":"hover:bg-gray-100 dark:hover:bg-gray-700 border border-transparent"),children:[(0,_.jsx)("button",{onClick:r=>{r.preventDefault(),r.stopPropagation(),console.log("\u041a\u043b\u0438\u043a \u043f\u043e \u0441\u0435\u0441\u0441\u0438\u0438:",e.id,"\u0422\u0435\u043a\u0443\u0449\u0430\u044f \u0441\u0435\u0441\u0441\u0438\u044f:",t),s&&"function"===typeof s?s(e.id):console.error("onSessionSelect \u043d\u0435 \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0444\u0443\u043d\u043a\u0446\u0438\u0435\u0439:",s)},className:"w-full p-3 text-left transition-all duration-200 ".concat(i?"px-2":""),title:i?e.title||"\u0411\u0435\u0437 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f":"",children:(0,_.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,_.jsx)(P.A,{className:"flex-shrink-0 ".concat(e.id===t?"text-primary-600 dark:text-primary-400":"text-gray-500 dark:text-gray-400"," ").concat(i?"h-5 w-5":"h-4 w-4")}),!i&&(0,_.jsx)("div",{className:"flex-1 min-w-0",children:f===e.id?(0,_.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,_.jsx)("input",{type:"text",value:j,onChange:e=>N(e.target.value),onKeyPress:t=>{"Enter"===t.key&&J(e.id),"Escape"===t.key&&K()},className:"flex-1 px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100",autoFocus:!0}),(0,_.jsx)("button",{onClick:()=>J(e.id),className:"p-1 text-green-600 hover:text-green-700",children:(0,_.jsx)(g.A,{className:"h-3 w-3"})}),(0,_.jsx)("button",{onClick:K,className:"p-1 text-red-600 hover:text-red-700",children:(0,_.jsx)(m.A,{className:"h-3 w-3"})})]}):(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)("p",{className:"text-sm font-medium truncate ".concat(e.id===t?"text-primary-800 dark:text-primary-200":"text-gray-900 dark:text-gray-100"),children:X(e.title)}),r?(0,_.jsxs)("div",{className:"mt-1",children:[(0,_.jsx)("p",{className:"text-xs text-primary-600 dark:text-primary-400 font-medium",children:"title"===r.matchType?"\u0421\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0435 \u0432 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0438":"\u041d\u0430\u0439\u0434\u0435\u043d\u043e ".concat(r.matchCount||1," ").concat(1===r.matchCount?"\u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435":"\u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439")}),"message"===r.matchType&&(0,_.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate mt-0.5",children:[r.matchText,"..."]})]}):e.last_message_preview&&(0,_.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate mt-1",children:e.last_message_preview}),(0,_.jsxs)("p",{className:"text-xs text-gray-400 dark:text-gray-500 flex items-center mt-1",children:[(0,_.jsx)(W.A,{className:"h-3 w-3 mr-1"}),Z(e.last_message_time||e.updated_at||e.created_at)]})]})})]})}),!i&&f!==e.id&&(0,_.jsx)("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:(0,_.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,_.jsx)("button",{onClick:t=>{t.stopPropagation(),(e=>{w(e.id),N(e.title||"\u0411\u0435\u0437 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f")})(e)},className:"p-1.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-white dark:hover:bg-gray-800 rounded transition-all duration-200",title:"\u041f\u0435\u0440\u0435\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u0442\u044c",children:(0,_.jsx)(M.A,{className:"h-3 w-3"})}),(0,_.jsx)("button",{onClick:s=>{s.stopPropagation(),(async e=>{if(window.confirm("\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u044d\u0442\u043e\u0442 \u0447\u0430\u0442? \u0412\u0441\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0431\u0443\u0434\u0443\u0442 \u043f\u043e\u0442\u0435\u0440\u044f\u043d\u044b."))try{await H.A.delete((0,v.e9)("/chat/sessions/".concat(e))),h(t=>t.filter(t=>t.id!==e)),e===t&&V()}catch(s){console.error("Error deleting session:",s),b("\u041e\u0448\u0438\u0431\u043a\u0430 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044f \u0447\u0430\u0442\u0430")}})(e.id)},className:"p-1.5 text-gray-400 hover:text-red-600 hover:bg-white dark:hover:bg-gray-800 rounded transition-all duration-200",title:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c",children:(0,_.jsx)(C.A,{className:"h-3 w-3"})})]})})]},e.id)})}):(0,_.jsxs)("div",{className:"p-4 text-center",children:[(0,_.jsx)(P.A,{className:"h-12 w-12 text-gray-400 dark:text-gray-500 mx-auto mb-3"}),!i&&(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)("p",{className:"text-gray-600 dark:text-gray-400 text-sm mb-3",children:k?"\u041d\u0435\u0442 \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0445 \u0447\u0430\u0442\u043e\u0432 \u0441 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f\u043c\u0438":"\u041f\u043e\u043a\u0430 \u043d\u0435\u0442 \u0438\u0441\u0442\u043e\u0440\u0438\u0438 \u0447\u0430\u0442\u043e\u0432"}),(0,_.jsx)("button",{onClick:V,className:"btn-glass-primary text-sm px-4 py-2",children:"\u041d\u0430\u0447\u0430\u0442\u044c \u043f\u0435\u0440\u0432\u044b\u0439 \u0447\u0430\u0442"})]})]})]}),!i&&(0,_.jsxs)("div",{className:"flex-shrink-0 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 overflow-visible",children:[(0,_.jsxs)("div",{className:"p-3",children:[(0,_.jsxs)("div",{className:"relative mb-2",children:[(0,_.jsx)(L.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400 dark:text-gray-500 z-10 pointer-events-none"}),(0,_.jsx)("input",{ref:G,type:"text",value:A,onChange:e=>R(e.target.value),onFocus:()=>{},placeholder:"\u041f\u043e\u0438\u0441\u043a \u043f\u043e \u0438\u0441\u0442\u043e\u0440\u0438\u0438...",className:"w-full pl-10 pr-10 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400",style:{display:"block"}}),A&&(0,_.jsx)("button",{onClick:()=>R(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 z-10",children:(0,_.jsx)(m.A,{className:"h-4 w-4"})})]}),O&&(0,_.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:"\u041f\u043e\u0438\u0441\u043a..."}),A.trim()&&!O&&(0,_.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:E.length>0?"\u041d\u0430\u0439\u0434\u0435\u043d\u043e: ".concat(E.length," ").concat(1===E.length?"\u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0435":"\u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439"):"\u041d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e"})]}),(0,_.jsxs)("div",{className:"px-3 pb-3 space-y-2 border-t border-gray-200 dark:border-gray-700 pt-3",children:[(0,_.jsxs)("label",{className:"flex items-center justify-between text-xs",children:[(0,_.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"\u041f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u043f\u0443\u0441\u0442\u044b\u0435 \u0447\u0430\u0442\u044b"}),(0,_.jsx)("button",{onClick:()=>S(!k),className:"relative inline-flex h-4 w-7 items-center rounded-full transition-colors duration-200 ".concat(k?"bg-primary-600":"bg-gray-300 dark:bg-gray-600"),children:(0,_.jsx)("span",{className:"inline-block h-3 w-3 transform rounded-full bg-white transition-transform duration-200 ".concat(k?"translate-x-3.5":"translate-x-0.5")})})]}),(0,_.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400 flex items-center justify-between",children:[(0,_.jsxs)("span",{children:["\u0412\u0441\u0435\u0433\u043e \u0447\u0430\u0442\u043e\u0432: ",u.length]}),(0,_.jsxs)("span",{className:"flex items-center",children:[(0,_.jsx)(z.A,{className:"h-3 w-3 mr-1"}),"\u0421\u0435\u0433\u043e\u0434\u043d\u044f"]})]}),u.length>0&&(0,_.jsxs)("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),(async()=>{if(0===u.length)return;const e="\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b, \u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0441\u0442\u0435\u0440\u0435\u0442\u044c \u0432\u0441\u044e \u0438\u0441\u0442\u043e\u0440\u0438\u044e \u0447\u0430\u0442\u043e\u0432?\n\n\u0411\u0443\u0434\u0435\u0442 \u0443\u0434\u0430\u043b\u0435\u043d\u043e ".concat(u.length," ").concat(1===u.length?"\u0447\u0430\u0442":u.length<5?"\u0447\u0430\u0442\u0430":"\u0447\u0430\u0442\u043e\u0432",".\n\n\u042d\u0442\u043e \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435 \u043d\u0435\u043b\u044c\u0437\u044f \u043e\u0442\u043c\u0435\u043d\u0438\u0442\u044c!");if(window.confirm(e))try{await H.A.delete((0,v.e9)("/chat/sessions/all")),h([]),Q({}),T([]),R(""),V()}catch(t){console.error("Error clearing all history:",t),b("\u041e\u0448\u0438\u0431\u043a\u0430 \u043e\u0447\u0438\u0441\u0442\u043a\u0438 \u0438\u0441\u0442\u043e\u0440\u0438\u0438")}})()},className:"w-full btn-glass-danger font-semibold rounded-xl transition-all duration-300 py-2.5 px-4 flex items-center justify-center space-x-2 mt-3",title:"\u0421\u0442\u0435\u0440\u0435\u0442\u044c \u0432\u0441\u044e \u0438\u0441\u0442\u043e\u0440\u0438\u044e \u0447\u0430\u0442\u043e\u0432","aria-label":"\u0421\u0442\u0435\u0440\u0435\u0442\u044c \u0432\u0441\u044e \u0438\u0441\u0442\u043e\u0440\u0438\u044e \u0447\u0430\u0442\u043e\u0432",type:"button",children:[(0,_.jsx)(F.A,{className:"h-4 w-4"}),(0,_.jsx)("span",{children:"\u0421\u0442\u0435\u0440\u0435\u0442\u044c \u0438\u0441\u0442\u043e\u0440\u0438\u044e"})]})]})]})]})};var U=s(3986),q=s(5263),Q=s(9285),G=s(2489),B=s(3165),V=s(5711),J=s(2382),K=s(1680),Z=s(1861),X=s(764),Y=s(4319);const $=["node"],ee=["node"],te=["node"],se=["node"],re=["node"],ne=["node"],ae=["node"],oe=["node"],ie=["node"],ce=["node"],le=["node","inline"],de=["node"],me=["node"],ue=["node"],he=["node"],xe=["node"],ge=["node"],pe=e=>{let{message:t,enhancements:s={}}=e;const[a,o]=(0,n.useState)(!1),[i,c]=(0,n.useState)(!1),[l,d]=(0,n.useState)(!1);if(!t)return console.warn("EnhancedResponse: message is undefined"),(0,_.jsx)("div",{className:"text-gray-500 italic",children:"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u043d\u043e"});if(!t.content||"string"!==typeof t.content)return console.warn("EnhancedResponse: message.content is undefined or not a string",t),(0,_.jsx)("div",{className:"text-gray-500 italic",children:"\u0421\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u043d\u043e"});const m=t.content.trim();if(!m)return(0,_.jsx)("div",{className:"text-gray-500 italic",children:"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043f\u0443\u0441\u0442\u043e"});const u=t.enhancements||s||{},x=u.fact_checking||{},g=u.explainability||{},p=u.overall_quality,y=void 0!==p&&null!==p?p:null,b=null!==y&&.5!==y,f=null!==y?(v=y)>=.8?{level:"high",color:"text-green-600 dark:text-green-400",bg:"bg-green-100 dark:bg-green-900/30"}:v>=.6?{level:"medium",color:"text-yellow-600 dark:text-yellow-400",bg:"bg-yellow-100 dark:bg-yellow-900/30"}:{level:"low",color:"text-red-600 dark:text-red-400",bg:"bg-red-100 dark:bg-red-900/30"}:null;var v;const w=e=>"number"===typeof e?"".concat((100*e).toFixed(1),"%"):e||"N/A";return(0,_.jsxs)("div",{className:"space-y-4",children:[(0,_.jsx)("div",{className:"markdown-content max-w-none",children:(0,_.jsx)(q.oz,{remarkPlugins:[Q.A],components:{h1:e=>{let{node:t}=e,s=(0,U.A)(e,$);return(0,_.jsx)("h1",(0,r.A)({className:"text-2xl font-bold mt-4 mb-2 text-gray-900 dark:text-gray-100"},s))},h2:e=>{let{node:t}=e,s=(0,U.A)(e,ee);return(0,_.jsx)("h2",(0,r.A)({className:"text-xl font-semibold mt-3 mb-2 text-gray-900 dark:text-gray-100"},s))},h3:e=>{let{node:t}=e,s=(0,U.A)(e,te);return(0,_.jsx)("h3",(0,r.A)({className:"text-lg font-semibold mt-3 mb-2 text-gray-900 dark:text-gray-100"},s))},h4:e=>{let{node:t}=e,s=(0,U.A)(e,se);return(0,_.jsx)("h4",(0,r.A)({className:"text-base font-semibold mt-2 mb-1 text-gray-900 dark:text-gray-100"},s))},p:e=>{let{node:t}=e,s=(0,U.A)(e,re);return(0,_.jsx)("p",(0,r.A)({className:"mb-2 text-gray-900 dark:text-gray-100 leading-relaxed"},s))},strong:e=>{let{node:t}=e,s=(0,U.A)(e,ne);return(0,_.jsx)("strong",(0,r.A)({className:"font-semibold text-gray-900 dark:text-gray-100"},s))},em:e=>{let{node:t}=e,s=(0,U.A)(e,ae);return(0,_.jsx)("em",(0,r.A)({className:"italic"},s))},ul:e=>{let{node:t}=e,s=(0,U.A)(e,oe);return(0,_.jsx)("ul",(0,r.A)({className:"list-disc list-inside mb-2 space-y-1 text-gray-900 dark:text-gray-100"},s))},ol:e=>{let{node:t}=e,s=(0,U.A)(e,ie);return(0,_.jsx)("ol",(0,r.A)({className:"list-decimal list-inside mb-2 space-y-1 text-gray-900 dark:text-gray-100"},s))},li:e=>{let{node:t}=e,s=(0,U.A)(e,ce);return(0,_.jsx)("li",(0,r.A)({className:"ml-2"},s))},code:e=>{let{node:t,inline:s}=e,n=(0,U.A)(e,le);return s?(0,_.jsx)("code",(0,r.A)({className:"bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded text-sm font-mono text-gray-900 dark:text-gray-100"},n)):(0,_.jsx)("code",(0,r.A)({className:"block bg-gray-100 dark:bg-gray-800 p-3 rounded-lg text-sm font-mono text-gray-900 dark:text-gray-100 overflow-x-auto mb-2"},n))},blockquote:e=>{let{node:t}=e,s=(0,U.A)(e,de);return(0,_.jsx)("blockquote",(0,r.A)({className:"border-l-4 border-blue-500 dark:border-blue-400 pl-4 italic my-2 text-gray-700 dark:text-gray-300"},s))},a:e=>{let{node:t}=e,s=(0,U.A)(e,me);return(0,_.jsx)("a",(0,r.A)({className:"text-blue-600 dark:text-blue-400 hover:underline",target:"_blank",rel:"noopener noreferrer"},s))},hr:e=>{let{node:t}=e,s=(0,U.A)(e,ue);return(0,_.jsx)("hr",(0,r.A)({className:"my-4 border-gray-300 dark:border-gray-600"},s))},table:e=>{let{node:t}=e,s=(0,U.A)(e,he);return(0,_.jsx)("div",{className:"overflow-x-auto my-2",children:(0,_.jsx)("table",(0,r.A)({className:"min-w-full border-collapse border border-gray-300 dark:border-gray-600"},s))})},th:e=>{let{node:t}=e,s=(0,U.A)(e,xe);return(0,_.jsx)("th",(0,r.A)({className:"border border-gray-300 dark:border-gray-600 px-3 py-2 bg-gray-100 dark:bg-gray-800 font-semibold text-left text-gray-900 dark:text-gray-100"},s))},td:e=>{let{node:t}=e,s=(0,U.A)(e,ge);return(0,_.jsx)("td",(0,r.A)({className:"border border-gray-300 dark:border-gray-600 px-3 py-2 text-gray-900 dark:text-gray-100"},s))}},children:m})}),b&&f&&(0,_.jsxs)("div",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border ".concat(f.bg," ").concat(f.color," neon-glow-purple"),children:[(0,_.jsx)(G.A,{className:"w-4 h-4 mr-2"}),"\u041a\u0430\u0447\u0435\u0441\u0442\u0432\u043e: ","high"===f.level?"\u0412\u044b\u0441\u043e\u043a\u043e\u0435":"medium"===f.level?"\u0421\u0440\u0435\u0434\u043d\u0435\u0435":"\u041d\u0438\u0437\u043a\u043e\u0435"]}),(0,_.jsxs)("div",{className:"flex flex-wrap gap-2",children:[Object.keys(x).length>0&&(0,_.jsxs)("button",{onClick:()=>o(!a),className:"flex items-center px-3 py-1 bg-blue-100 text-blue-700 rounded-lg text-sm hover:bg-blue-200 transition-colors",children:[(0,_.jsx)(B.A,{className:"w-4 h-4 mr-2"}),"\u0424\u0430\u043a\u0442-\u0447\u0435\u043a\u0438\u043d\u0433",a?(0,_.jsx)(V.A,{className:"w-4 h-4 ml-1"}):(0,_.jsx)(J.A,{className:"w-4 h-4 ml-1"})]}),g.sources&&g.sources.length>0&&(0,_.jsxs)("button",{onClick:()=>c(!i),className:"flex items-center px-3 py-1 bg-green-100 text-green-700 rounded-lg text-sm hover:bg-green-200 transition-colors",children:[(0,_.jsx)(K.A,{className:"w-4 h-4 mr-2"}),"\u0418\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0438 (",g.sources.length,")",i?(0,_.jsx)(V.A,{className:"w-4 h-4 ml-1"}):(0,_.jsx)(J.A,{className:"w-4 h-4 ml-1"})]}),g.warnings&&g.warnings.length>0&&(0,_.jsxs)("button",{onClick:()=>d(!l),className:"flex items-center px-3 py-1 bg-yellow-100 text-yellow-700 rounded-lg text-sm hover:bg-yellow-200 transition-colors",children:[(0,_.jsx)(Z.A,{className:"w-4 h-4 mr-2"}),"\u041f\u0440\u0435\u0434\u0443\u043f\u0440\u0435\u0436\u0434\u0435\u043d\u0438\u044f (",g.warnings.length,")",l?(0,_.jsx)(V.A,{className:"w-4 h-4 ml-1"}):(0,_.jsx)(J.A,{className:"w-4 h-4 ml-1"})]})]}),a&&Object.keys(x).length>0&&(0,_.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[(0,_.jsxs)("h4",{className:"font-semibold text-blue-900 dark:text-blue-100 mb-3 flex items-center",children:[(0,_.jsx)(B.A,{className:"w-5 h-5 mr-2"}),"\u0410\u043d\u0430\u043b\u0438\u0437 \u0444\u0430\u043a\u0442-\u0447\u0435\u043a\u0438\u043d\u0433\u0430"]}),(0,_.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,_.jsxs)("div",{className:"space-y-2",children:[(0,_.jsxs)("div",{className:"flex justify-between",children:[(0,_.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"\u0422\u043e\u0447\u043d\u043e\u0441\u0442\u044c \u0441\u0441\u044b\u043b\u043e\u043a:"}),(0,_.jsx)("span",{className:"font-medium ".concat(x.citation_recall>=.7?"text-green-600":"text-red-600"),children:w(x.citation_recall)})]}),(0,_.jsxs)("div",{className:"flex justify-between",children:[(0,_.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"\u041f\u043e\u043a\u0440\u044b\u0442\u0438\u0435 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u043e\u043c:"}),(0,_.jsx)("span",{className:"font-medium ".concat(x.support_coverage>=.5?"text-green-600":"text-yellow-600"),children:w(x.support_coverage)})]})]}),(0,_.jsxs)("div",{className:"space-y-2",children:[(0,_.jsxs)("div",{className:"flex justify-between",children:[(0,_.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"\u0420\u0438\u0441\u043a \u0433\u0430\u043b\u043b\u044e\u0446\u0438\u043d\u0430\u0446\u0438\u0439:"}),(0,_.jsx)("span",{className:"font-medium ".concat(x.hallucination_score<=.3?"text-green-600":"text-red-600"),children:w(x.hallucination_score)})]}),(0,_.jsxs)("div",{className:"flex justify-between",children:[(0,_.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"\u041f\u0440\u0430\u0432\u043e\u0432\u0430\u044f \u0441\u043e\u0433\u043b\u0430\u0441\u043e\u0432\u0430\u043d\u043d\u043e\u0441\u0442\u044c:"}),(0,_.jsx)("span",{className:"font-medium ".concat(x.legal_consistency>=.8?"text-green-600":"text-yellow-600"),children:w(x.legal_consistency)})]})]})]})]}),i&&g.sources&&g.sources.length>0&&(0,_.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4",children:[(0,_.jsxs)("h4",{className:"font-semibold text-green-900 dark:text-green-100 mb-3 flex items-center",children:[(0,_.jsx)(K.A,{className:"w-5 h-5 mr-2"}),"\u0418\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0438 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438"]}),(0,_.jsx)("div",{className:"space-y-3",children:g.sources.map((e,t)=>(0,_.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-3 border border-green-200 dark:border-green-700",children:(0,_.jsxs)("div",{className:"flex items-start justify-between",children:[(0,_.jsxs)("div",{className:"flex-1",children:[(0,_.jsxs)("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:[e.code," ",e.article," ",e.part," ",e.item]}),e.edition&&(0,_.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.edition}),(0,_.jsx)("div",{className:"text-sm text-gray-700 dark:text-gray-300 mt-2",children:e.excerpt}),e.url&&(0,_.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center text-sm text-blue-600 hover:text-blue-800 mt-2",children:[(0,_.jsx)(X.A,{className:"w-4 h-4 mr-1"}),"\u041e\u0442\u043a\u0440\u044b\u0442\u044c \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a"]})]}),e.relevance_score&&(0,_.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",children:[Math.round(100*e.relevance_score),"%"]})]})},t))})]}),l&&g.warnings&&g.warnings.length>0&&(0,_.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:[(0,_.jsxs)("h4",{className:"font-semibold text-yellow-900 dark:text-yellow-100 mb-3 flex items-center",children:[(0,_.jsx)(Z.A,{className:"w-5 h-5 mr-2"}),"\u0412\u0430\u0436\u043d\u044b\u0435 \u043f\u0440\u0435\u0434\u0443\u043f\u0440\u0435\u0436\u0434\u0435\u043d\u0438\u044f"]}),(0,_.jsx)("div",{className:"space-y-2",children:g.warnings.map((e,t)=>(0,_.jsxs)("div",{className:"flex items-start space-x-2 text-sm text-yellow-800 dark:text-yellow-200",children:[(0,_.jsx)(Z.A,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),(0,_.jsx)("span",{children:e})]},t))})]}),g.user_actions&&g.user_actions.length>0&&(0,_.jsxs)("div",{className:"bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 rounded-lg p-4",children:[(0,_.jsxs)("h4",{className:"font-semibold text-purple-900 dark:text-purple-100 mb-3 flex items-center",children:[(0,_.jsx)(h.A,{className:"w-5 h-5 mr-2"}),"\u0420\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0430\u0446\u0438\u0438"]}),(0,_.jsx)("div",{className:"space-y-2",children:g.user_actions.map((e,t)=>(0,_.jsxs)("div",{className:"flex items-start space-x-2 text-sm text-purple-800 dark:text-purple-200",children:[(0,_.jsx)(Y.A,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),(0,_.jsx)("span",{children:e})]},t))})]}),g.arguments&&g.arguments.length>0&&(0,_.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[(0,_.jsxs)("h4",{className:"font-semibold text-gray-900 dark:text-gray-100 mb-3 flex items-center",children:[(0,_.jsx)(K.A,{className:"w-5 h-5 mr-2"}),"\u0410\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044f"]}),(0,_.jsx)("div",{className:"space-y-3",children:g.arguments.map((e,t)=>(0,_.jsx)("div",{className:"bg-white dark:bg-gray-700 rounded-lg p-3",children:(0,_.jsx)("div",{className:"flex items-start justify-between",children:(0,_.jsxs)("div",{className:"flex-1",children:[(0,_.jsx)("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:e.text}),e.confidence&&(0,_.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["\u0423\u0432\u0435\u0440\u0435\u043d\u043d\u043e\u0441\u0442\u044c: ",Math.round(100*e.confidence),"%"]})]})})},t))})]}),g.metadata&&(0,_.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400 flex items-center space-x-4",children:[(0,_.jsxs)("div",{className:"flex items-center",children:[(0,_.jsx)(W.A,{className:"w-3 h-3 mr-1"}),g.metadata.created_at&&new Date(g.metadata.created_at).toLocaleString("ru-RU")]}),g.metadata.sources_count&&(0,_.jsxs)("div",{children:["\u0418\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u043e\u0432: ",g.metadata.sources_count]})]})]})};var ye=s(6095),be=s(9598);const fe=e=>{let{messageId:t,onFeedbackSubmitted:s}=e;const[r,a]=(0,n.useState)(null),[o,i]=(0,n.useState)(!1),[c,l]=(0,n.useState)(""),[d,m]=(0,n.useState)(""),[u,h]=(0,n.useState)(!1);return r?(0,_.jsx)("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:"positive"===r?(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(ye.A,{className:"w-4 h-4 text-green-500 fill-current"}),(0,_.jsx)("span",{children:"\u0421\u043f\u0430\u0441\u0438\u0431\u043e \u0437\u0430 \u043e\u0446\u0435\u043d\u043a\u0443!"})]}):(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(be.A,{className:"w-4 h-4 text-red-500 fill-current"}),(0,_.jsx)("span",{children:"\u0421\u043f\u0430\u0441\u0438\u0431\u043e \u0437\u0430 \u043e\u0431\u0440\u0430\u0442\u043d\u0443\u044e \u0441\u0432\u044f\u0437\u044c!"})]})}):(0,_.jsxs)(_.Fragment,{children:[(0,_.jsxs)("div",{className:"flex items-center gap-2",children:[(0,_.jsxs)("button",{onClick:async()=>{try{h(!0);const e=localStorage.getItem("token");await H.A.post("".concat("https://advacodex.com/api/v1","/api/v1/feedback/rate"),{message_id:t,rating:"positive"},{headers:{Authorization:"Bearer ".concat(e)}}),a("positive"),s&&s("positive")}catch(e){console.error("Error submitting positive feedback:",e),alert("\u041e\u0448\u0438\u0431\u043a\u0430 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u043e\u0446\u0435\u043d\u043a\u0438")}finally{h(!1)}},disabled:u,className:"flex items-center gap-1 px-3 py-1.5 text-sm text-gray-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors disabled:opacity-50",title:"\u041f\u043e\u043b\u0435\u0437\u043d\u043e",children:[(0,_.jsx)(ye.A,{className:"w-4 h-4"}),(0,_.jsx)("span",{children:"\u041f\u043e\u043b\u0435\u0437\u043d\u043e"})]}),(0,_.jsxs)("button",{onClick:()=>{i(!0)},disabled:u,className:"flex items-center gap-1 px-3 py-1.5 text-sm text-gray-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors disabled:opacity-50",title:"\u041d\u0435 \u043f\u043e\u043c\u043e\u0433\u043b\u043e",children:[(0,_.jsx)(be.A,{className:"w-4 h-4"}),(0,_.jsx)("span",{children:"\u041d\u0435 \u043f\u043e\u043c\u043e\u0433\u043b\u043e"})]})]}),o&&(0,_.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,_.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[(0,_.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"\u041f\u043e\u0447\u0435\u043c\u0443 \u043e\u0442\u0432\u0435\u0442 \u043d\u0435 \u043f\u043e\u043c\u043e\u0433?"}),(0,_.jsx)("div",{className:"space-y-2 mb-4",children:[{value:"not_answered",label:"\u041d\u0435 \u043e\u0442\u0432\u0435\u0442\u0438\u043b \u043d\u0430 \u0432\u043e\u043f\u0440\u043e\u0441"},{value:"inaccurate",label:"\u041d\u0435\u0442\u043e\u0447\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f"},{value:"hard_to_understand",label:"\u0421\u043b\u043e\u0436\u043d\u043e \u043f\u043e\u043d\u044f\u0442\u044c"},{value:"other",label:"\u0414\u0440\u0443\u0433\u043e\u0435"}].map(e=>(0,_.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,_.jsx)("input",{type:"radio",name:"reason",value:e.value,checked:c===e.value,onChange:e=>l(e.target.value),className:"w-4 h-4 text-blue-600"}),(0,_.jsx)("span",{className:"text-sm",children:e.label})]},e.value))}),(0,_.jsx)("textarea",{value:d,onChange:e=>m(e.target.value),placeholder:"\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439 (\u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e)",className:"w-full px-3 py-2 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:"3"}),(0,_.jsxs)("div",{className:"flex gap-2 mt-4",children:[(0,_.jsx)("button",{onClick:async()=>{if(c)try{h(!0);const e=localStorage.getItem("token");await H.A.post("".concat("https://advacodex.com/api/v1","/api/v1/feedback/rate"),{message_id:t,rating:"negative",reason:c,comment:d||void 0},{headers:{Authorization:"Bearer ".concat(e)}}),a("negative"),i(!1),s&&s("negative")}catch(e){console.error("Error submitting negative feedback:",e),alert("\u041e\u0448\u0438\u0431\u043a\u0430 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u043e\u0446\u0435\u043d\u043a\u0438")}finally{h(!1)}else alert("\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043f\u0440\u0438\u0447\u0438\u043d\u0443")},disabled:u||!c,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:u?"\u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430...":"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"}),(0,_.jsx)("button",{onClick:()=>{i(!1),l(""),m("")},disabled:u,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50",children:"\u041e\u0442\u043c\u0435\u043d\u0430"})]})]})})]})};var ve=s(5613),we=s(2861),je=s(59),Ne=s(73),ke=s(1885);const Se=e=>{let{error:t,onRetry:s,onReconnect:r,className:n="",showIcon:a=!0,variant:o="default"}=e;const i=(e=>{var t,s,r;if("string"===typeof e)return{type:"general",title:"\u041e\u0448\u0438\u0431\u043a\u0430",message:e,icon:ve.A,color:"red",actions:["retry"]};if(null!==e&&void 0!==e&&e.code)switch(e.code){case 1008:return{type:"auth",title:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438",message:"\u0412\u0430\u0448\u0430 \u0441\u0435\u0441\u0441\u0438\u044f \u0438\u0441\u0442\u0435\u043a\u043b\u0430. \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u043e\u0439\u0434\u0438\u0442\u0435 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0443 \u0437\u0430\u043d\u043e\u0432\u043e.",icon:ve.A,color:"red",actions:["login"]};case 1006:return{type:"connection",title:"\u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u043f\u043e\u0442\u0435\u0440\u044f\u043d\u043e",message:"\u0421\u0432\u044f\u0437\u044c \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c \u043f\u0440\u0435\u0440\u0432\u0430\u043d\u0430. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0435\u043c \u043f\u0435\u0440\u0435\u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438.",icon:we.A,color:"orange",actions:["reconnect","retry"]};case 1011:return{type:"server",title:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430",message:"\u041d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u043f\u043e\u0437\u0436\u0435 \u0438\u043b\u0438 \u043e\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044c \u0432 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0443.",icon:je.A,color:"red",actions:["retry","support"]};case 408:return{type:"timeout",title:"\u041f\u0440\u0435\u0432\u044b\u0448\u0435\u043d\u043e \u0432\u0440\u0435\u043c\u044f \u043e\u0436\u0438\u0434\u0430\u043d\u0438\u044f",message:"\u0413\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f \u043e\u0442\u0432\u0435\u0442\u0430 \u0437\u0430\u043d\u044f\u043b\u0430 \u0441\u043b\u0438\u0448\u043a\u043e\u043c \u043c\u043d\u043e\u0433\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0443\u043f\u0440\u043e\u0441\u0442\u0438\u0442\u044c \u0432\u043e\u043f\u0440\u043e\u0441.",icon:W.A,color:"orange",actions:["retry"]};case 503:return{type:"overload",title:"\u0421\u0435\u0440\u0432\u0435\u0440 \u043f\u0435\u0440\u0435\u0433\u0440\u0443\u0436\u0435\u043d",message:"\u0421\u0435\u0440\u0432\u0435\u0440 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e \u043f\u0435\u0440\u0435\u0433\u0440\u0443\u0436\u0435\u043d. \u041f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435 \u043d\u0435\u043c\u043d\u043e\u0433\u043e \u0438 \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0441\u043d\u043e\u0432\u0430.",icon:Ne.A,color:"yellow",actions:["retry"]};default:return{type:"unknown",title:"\u041d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430",message:e.message||"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0435 \u0440\u0430\u0437.",icon:ve.A,color:"red",actions:["retry"]}}if(null!==e&&void 0!==e&&null!==(t=e.response)&&void 0!==t&&t.status){const t=e.response.status;if(401===t)return{type:"auth",title:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f",message:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u043e\u0439\u0434\u0438\u0442\u0435 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0443 \u0434\u043b\u044f \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0435\u043d\u0438\u044f \u0440\u0430\u0431\u043e\u0442\u044b.",icon:ve.A,color:"red",actions:["login"]};if(429===t)return{type:"rate_limit",title:"\u0421\u043b\u0438\u0448\u043a\u043e\u043c \u043c\u043d\u043e\u0433\u043e \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432",message:"\u0412\u044b \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u043b\u0438 \u0441\u043b\u0438\u0448\u043a\u043e\u043c \u043c\u043d\u043e\u0433\u043e \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432. \u041f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435 \u043d\u0435\u043c\u043d\u043e\u0433\u043e \u043f\u0435\u0440\u0435\u0434 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u043c \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u043c.",icon:W.A,color:"orange",actions:["wait"]};if(503===t)return{type:"overload",title:"\u0421\u0435\u0440\u0432\u0435\u0440 \u043f\u0435\u0440\u0435\u0433\u0440\u0443\u0436\u0435\u043d",message:"\u0421\u0435\u0440\u0432\u0435\u0440 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e \u043f\u0435\u0440\u0435\u0433\u0440\u0443\u0436\u0435\u043d. \u041f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435 \u043d\u0435\u043c\u043d\u043e\u0433\u043e \u0438 \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0441\u043d\u043e\u0432\u0430.",icon:Ne.A,color:"yellow",actions:["retry"]};if(t>=500)return{type:"server",title:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430",message:"\u041d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430. \u041c\u044b \u0443\u0436\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u043c \u043d\u0430\u0434 \u0435\u0451 \u0443\u0441\u0442\u0440\u0430\u043d\u0435\u043d\u0438\u0435\u043c.",icon:je.A,color:"red",actions:["retry","support"]}}return null===e||void 0===e||!e.request||null!==e&&void 0!==e&&e.response?null!==e&&void 0!==e&&null!==(s=e.message)&&void 0!==s&&s.includes("\u043c\u043e\u0434\u0435\u043b\u044c")||null!==e&&void 0!==e&&null!==(r=e.message)&&void 0!==r&&r.includes("\u0418\u0418")?{type:"ai_model",title:"\u041c\u043e\u0434\u0435\u043b\u044c \u0418\u0418 \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0430",message:"\u041c\u043e\u0434\u0435\u043b\u044c \u0438\u0441\u043a\u0443\u0441\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0433\u043e \u0438\u043d\u0442\u0435\u043b\u043b\u0435\u043a\u0442\u0430 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0430. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u043f\u043e\u0437\u0436\u0435.",icon:ve.A,color:"orange",actions:["retry","support"]}:{type:"general",title:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430",message:(null===e||void 0===e?void 0:e.message)||"\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0435 \u0440\u0430\u0437.",icon:ve.A,color:"red",actions:["retry"]}:{type:"network",title:"\u041f\u0440\u043e\u0431\u043b\u0435\u043c\u0430 \u0441 \u0441\u0435\u0442\u044c\u044e",message:"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u043e\u0435\u0434\u0438\u043d\u0438\u0442\u044c\u0441\u044f \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c. \u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u043a \u0438\u043d\u0442\u0435\u0440\u043d\u0435\u0442\u0443.",icon:we.A,color:"red",actions:["reconnect","retry"]}})(t),l=i.icon,d=e=>{const t={red:"bg-red-50 border-red-200 text-red-800",orange:"bg-orange-50 border-orange-200 text-orange-800",yellow:"bg-yellow-50 border-yellow-200 text-yellow-800",blue:"bg-blue-50 border-blue-200 text-blue-800"};return t[e]||t.red},m=e=>{const t={red:"bg-red-600 hover:bg-red-700 text-white",orange:"bg-orange-600 hover:bg-orange-700 text-white",yellow:"bg-yellow-600 hover:bg-yellow-700 text-white",blue:"bg-blue-600 hover:bg-blue-700 text-white"};return t[e]||t.red},u=()=>i.actions.map(e=>{switch(e){case"retry":return(0,_.jsxs)("button",{onClick:s,className:"px-3 py-1 text-sm font-medium rounded transition-colors ".concat(m(i.color)),children:[(0,_.jsx)(c.A,{className:"w-4 h-4 inline mr-1"}),"\u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u044c"]},"retry");case"reconnect":return(0,_.jsxs)("button",{onClick:r,className:"px-3 py-1 text-sm font-medium rounded transition-colors ".concat(m(i.color)),children:[(0,_.jsx)(ke.A,{className:"w-4 h-4 inline mr-1"}),"\u041f\u0435\u0440\u0435\u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c"]},"reconnect");case"login":return(0,_.jsx)("button",{onClick:()=>window.location.href="/login",className:"px-3 py-1 text-sm font-medium rounded transition-colors ".concat(m(i.color)),children:"\u0412\u043e\u0439\u0442\u0438"},"login");case"support":return(0,_.jsx)("button",{onClick:()=>window.open("mailto:support@advacodex.com","_blank"),className:"px-3 py-1 text-sm font-medium bg-gray-600 hover:bg-gray-700 text-white rounded transition-colors",children:"\u041f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0430"},"support");case"wait":return(0,_.jsx)("span",{className:"text-sm text-gray-600",children:"\u041f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435 1-2 \u043c\u0438\u043d\u0443\u0442\u044b"},"wait");default:return null}});return"toast"===o?(0,_.jsx)("div",{className:"fixed top-4 right-4 z-50 max-w-sm ".concat(n),children:(0,_.jsx)("div",{className:"p-4 rounded-lg border shadow-lg ".concat(d(i.color)),children:(0,_.jsxs)("div",{className:"flex items-start space-x-3",children:[a&&(0,_.jsx)(l,{className:"w-5 h-5 mt-0.5 flex-shrink-0"}),(0,_.jsxs)("div",{className:"flex-1",children:[(0,_.jsx)("h4",{className:"text-sm font-medium mb-1",children:i.title}),(0,_.jsx)("p",{className:"text-sm opacity-90 mb-3",children:i.message}),(0,_.jsx)("div",{className:"flex space-x-2",children:u()})]})]})})}):"inline"===o?(0,_.jsxs)("div",{className:"flex items-center space-x-2 p-2 rounded ".concat(d(i.color)," ").concat(n),children:[a&&(0,_.jsx)(l,{className:"w-4 h-4 flex-shrink-0"}),(0,_.jsx)("span",{className:"text-sm flex-1",children:i.message}),(0,_.jsx)("div",{className:"flex space-x-1",children:u()})]}):(0,_.jsx)("div",{className:"p-4 rounded-lg border ".concat(d(i.color)," ").concat(n),children:(0,_.jsxs)("div",{className:"flex items-start space-x-3",children:[a&&(0,_.jsx)(l,{className:"w-5 h-5 mt-0.5 flex-shrink-0"}),(0,_.jsxs)("div",{className:"flex-1",children:[(0,_.jsx)("h3",{className:"text-sm font-medium mb-1",children:i.title}),(0,_.jsx)("p",{className:"text-sm opacity-90 mb-3",children:i.message}),(0,_.jsx)("div",{className:"flex space-x-2",children:u()})]})]})})};var Ae=s(6382),Re=s(6446),Ce=s(9570);const Ee=e=>{let{isGenerating:t,onStop:s,startTime:r,estimatedTime:a,className:o="",variant:c="default"}=e;const[l,d]=(0,n.useState)(0),[m,u]=(0,n.useState)(0),h=[{text:"\u0418\u0418 \u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0435\u0442 \u0432\u0430\u0448 \u0432\u043e\u043f\u0440\u043e\u0441...",icon:Ae.A},{text:"\u0418\u0418 \u0438\u0449\u0435\u0442 \u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u0443\u044e \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e...",icon:Ne.A},{text:"\u0418\u0418 \u0444\u043e\u0440\u043c\u0443\u043b\u0438\u0440\u0443\u0435\u0442 \u043e\u0442\u0432\u0435\u0442...",icon:i.A},{text:"\u0418\u0418 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0442\u043e\u0447\u043d\u043e\u0441\u0442\u044c \u043e\u0442\u0432\u0435\u0442\u0430...",icon:W.A}];(0,n.useEffect)(()=>{if(!t||!r)return d(0),void u(0);const e=setInterval(()=>{const e=Math.floor((Date.now()-r)/1e3);d(e);const t=Math.floor(e/5)%h.length;u(t)},1e3);return()=>clearInterval(e)},[t,r,h.length]);const x=e=>{const t=Math.floor(e/60),s=e%60;return t>0?"".concat(t,":").concat(s.toString().padStart(2,"0")):"".concat(s,"\u0441")},g=h[m],p=g.icon;return t?"compact"===c?(0,_.jsxs)("div",{className:"flex items-center space-x-2 ".concat(o),children:[(0,_.jsx)(Re.P.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full"}),(0,_.jsx)("span",{className:"text-sm text-gray-600",children:"\u0418\u0418 \u0434\u0443\u043c\u0430\u0435\u0442..."}),s&&(0,_.jsx)("button",{onClick:s,className:"p-1 text-red-600 hover:text-red-700 hover:bg-red-50 rounded transition-colors",title:"\u041e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044e",children:(0,_.jsx)(S.A,{className:"w-3 h-3"})})]}):"detailed"===c?(0,_.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm ".concat(o),children:(0,_.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,_.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center",children:(0,_.jsx)(Re.P.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},children:(0,_.jsx)(i.A,{className:"w-4 h-4 text-white"})})}),(0,_.jsxs)("div",{className:"flex-1",children:[(0,_.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,_.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,_.jsx)(p,{className:"w-4 h-4 text-blue-600"}),(0,_.jsx)(Ce.N,{mode:"wait",children:(0,_.jsx)(Re.P.span,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"text-sm font-medium text-gray-700",children:g.text},m)})]}),(0,_.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,_.jsx)("span",{className:"text-xs text-gray-500",children:x(l)}),s&&(0,_.jsxs)("button",{onClick:s,className:"px-2 py-1 text-xs bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors flex items-center space-x-1",title:"\u041e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044e",children:[(0,_.jsx)(S.A,{className:"w-3 h-3"}),(0,_.jsx)("span",{children:"\u041e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c"})]})]})]}),a&&(0,_.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-2",children:(0,_.jsx)(Re.P.div,{className:"bg-blue-600 h-2 rounded-full",initial:{width:0},animate:{width:"".concat(a?Math.min(l/a*100,95):0,"%")},transition:{duration:.5}})}),(0,_.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,_.jsx)("span",{children:a?"\u041f\u0440\u0438\u043c\u0435\u0440\u043d\u043e\u0435 \u0432\u0440\u0435\u043c\u044f: ".concat(x(a)):"\u0413\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f \u0432 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0435..."}),l>30&&(0,_.jsx)("span",{className:"text-orange-600",children:"\u0421\u043b\u043e\u0436\u043d\u044b\u0439 \u0432\u043e\u043f\u0440\u043e\u0441, \u0442\u0440\u0435\u0431\u0443\u0435\u0442 \u0431\u043e\u043b\u044c\u0448\u0435 \u0432\u0440\u0435\u043c\u0435\u043d\u0438"})]})]})]})}):(0,_.jsxs)("div",{className:"flex items-center justify-between p-3 bg-white border border-gray-200 rounded-lg ".concat(o),children:[(0,_.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,_.jsx)(Re.P.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},className:"w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full"}),(0,_.jsxs)("div",{children:[(0,_.jsx)(Ce.N,{mode:"wait",children:(0,_.jsxs)(Re.P.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},className:"flex items-center space-x-2",children:[(0,_.jsx)(p,{className:"w-4 h-4 text-blue-600"}),(0,_.jsx)("span",{className:"text-sm font-medium text-gray-700",children:g.text})]},m)}),(0,_.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[(0,_.jsx)("span",{className:"text-xs text-gray-500",children:x(l)}),l>60&&(0,_.jsx)("span",{className:"text-xs text-orange-600",children:"\u2022 \u0421\u043b\u043e\u0436\u043d\u044b\u0439 \u0437\u0430\u043f\u0440\u043e\u0441"})]})]})]}),s&&(0,_.jsxs)("button",{onClick:s,className:"px-3 py-1 text-sm bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors flex items-center space-x-1",title:"\u041e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044e",children:[(0,_.jsx)(S.A,{className:"w-3 h-3"}),(0,_.jsx)("span",{children:"\u041e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c"})]})]}):null};var _e=s(4537);const Te=e=>{var t;let{websocket:s,onReconnect:a,onForceReconnect:o,showDetails:i=!1,autoHide:l=!0,className:d=""}=e;const[m,u]=(0,n.useState)(null),[h,x]=(0,n.useState)(!1),[g,p]=(0,n.useState)(!1),[y,b]=(0,n.useState)(null),[f,v]=(0,n.useState)(0);if((0,n.useEffect)(()=>{if(!s)return;const e=()=>{const e=s.getStatus(),t=s.getUserFriendlyStatus();u((0,r.A)((0,r.A)({},e),t))};e();const t=t=>{e(),["connecting","reconnecting","failed"].includes(t)?x(!0):"connected"===t&&(x(!0),l&&setTimeout(()=>x(!1),3e3))},n=t=>{b(t),x(!0),e()};s.on("stateChange",t),s.on("error",n),s.on("open",e),s.on("close",e);const a=setInterval(e,5e3);return()=>{s.off("stateChange",t),s.off("error",n),s.off("open",e),s.off("close",e),clearInterval(a)}},[s,l]),(0,n.useEffect)(()=>{if("reconnecting"===(null===m||void 0===m?void 0:m.connectionState)&&s){const e=(()=>{var e;const t=(null===(e=s.options)||void 0===e?void 0:e.reconnectDelay)||1e3,r=m.reconnectAttempts||0,n=Math.min(t*Math.pow(2,r),3e4);v(Math.ceil(n/1e3));const a=setInterval(()=>{v(e=>e<=1?(clearInterval(a),0):e-1)},1e3);return a})();return()=>clearInterval(e)}},[null===m||void 0===m?void 0:m.connectionState,null===m||void 0===m?void 0:m.reconnectAttempts,s]),!m)return null;const w=()=>{o?o():a?a():s&&s.reconnect()};return i||h?(0,_.jsxs)("div",{className:d,children:[(0,_.jsx)(Ce.N,{children:(h||i)&&(0,_.jsxs)(Re.P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"\n              flex items-center justify-between p-3 rounded-lg border transition-all duration-300\n              ".concat((()=>{switch(m.color){case"green":return"bg-green-50 border-green-200 text-green-800";case"yellow":return"bg-yellow-50 border-yellow-200 text-yellow-800";case"orange":return"bg-orange-50 border-orange-200 text-orange-800";case"red":return"bg-red-50 border-red-200 text-red-800";case"blue":return"bg-blue-50 border-blue-200 text-blue-800";default:return"bg-gray-50 border-gray-200 text-gray-800"}})(),"\n            "),children:[(0,_.jsxs)("div",{className:"flex items-center space-x-3",children:[(()=>{switch(m.icon){case"connected":return(0,_.jsx)(Y.A,{className:"h-4 w-4 text-green-600"});case"connecting":case"reconnecting":return(0,_.jsx)(Re.P.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:(0,_.jsx)(c.A,{className:"h-4 w-4 text-blue-600"})});case"disconnected":return(0,_.jsx)(we.A,{className:"h-4 w-4 text-gray-600"});case"error":return(0,_.jsx)(ve.A,{className:"h-4 w-4 text-red-600"});default:return(0,_.jsx)(ke.A,{className:"h-4 w-4 text-gray-600"})}})(),(0,_.jsxs)("div",{children:[(0,_.jsx)("div",{className:"text-sm font-medium",children:m.text}),m.reconnectAttempts>0&&(0,_.jsxs)("div",{className:"text-xs opacity-75",children:["\u041f\u043e\u043f\u044b\u0442\u043a\u0430 ",m.reconnectAttempts,"/",(null===s||void 0===s||null===(t=s.options)||void 0===t?void 0:t.maxReconnectAttempts)||10,f>0&&" \u2022 \u0421\u043b\u0435\u0434\u0443\u044e\u0449\u0430\u044f \u0447\u0435\u0440\u0435\u0437 ".concat(f,"\u0441")]}),m.queuedMessages>0&&(0,_.jsxs)("div",{className:"text-xs opacity-75",children:[m.queuedMessages," \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0432 \u043e\u0447\u0435\u0440\u0435\u0434\u0438"]}),y&&"failed"===m.connectionState&&(0,_.jsx)("div",{className:"text-xs text-red-600 mt-1",children:y.message||"\u041e\u0448\u0438\u0431\u043a\u0430 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f"})]})]}),(0,_.jsxs)("div",{className:"flex items-center space-x-2",children:[["failed","disconnected"].includes(m.connectionState)&&(0,_.jsx)("button",{onClick:w,className:"px-3 py-1 text-xs font-medium bg-white rounded border hover:bg-gray-50 transition-colors",children:"\u041f\u0435\u0440\u0435\u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c"}),"reconnecting"===m.connectionState&&(0,_.jsx)("button",{onClick:w,className:"px-3 py-1 text-xs font-medium bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"\u041f\u0435\u0440\u0435\u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0441\u0435\u0439\u0447\u0430\u0441"}),i&&(0,_.jsx)("button",{onClick:()=>p(!g),className:"p-1 hover:bg-white hover:bg-opacity-50 rounded transition-colors",children:(0,_.jsx)(_e.A,{className:"h-4 w-4"})}),h&&!i&&l&&(0,_.jsx)("button",{onClick:()=>x(!1),className:"p-1 hover:bg-white hover:bg-opacity-50 rounded transition-colors",children:"\xd7"})]})]})}),(0,_.jsx)(Ce.N,{children:g&&m.stats&&(0,_.jsx)(Re.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-2 p-3 bg-white rounded-lg border border-gray-200 text-sm",children:(0,_.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,_.jsxs)("div",{children:[(0,_.jsx)("div",{className:"font-medium text-gray-700 mb-2",children:"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f"}),(0,_.jsxs)("div",{className:"space-y-1 text-gray-600",children:[(0,_.jsxs)("div",{className:"flex justify-between",children:[(0,_.jsx)("span",{children:"\u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0439:"}),(0,_.jsx)("span",{children:m.stats.totalConnections})]}),(0,_.jsxs)("div",{className:"flex justify-between",children:[(0,_.jsx)("span",{children:"\u041f\u0435\u0440\u0435\u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0439:"}),(0,_.jsx)("span",{children:m.stats.totalReconnections})]}),(0,_.jsxs)("div",{className:"flex justify-between",children:[(0,_.jsx)("span",{children:"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439:"}),(0,_.jsx)("span",{children:m.stats.totalMessages})]})]})]}),(0,_.jsxs)("div",{children:[(0,_.jsx)("div",{className:"font-medium text-gray-700 mb-2",children:"\u0412\u0440\u0435\u043c\u044f \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f"}),(0,_.jsxs)("div",{className:"space-y-1 text-gray-600",children:[m.stats.lastConnectedAt&&(0,_.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,_.jsx)(W.A,{className:"h-3 w-3"}),(0,_.jsx)("span",{className:"text-xs",children:new Date(m.stats.lastConnectedAt).toLocaleTimeString()})]}),m.lastPong&&(0,_.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,_.jsx)(Ne.A,{className:"h-3 w-3"}),(0,_.jsxs)("span",{className:"text-xs",children:["Ping: ",Date.now()-m.lastPong,"ms \u043d\u0430\u0437\u0430\u0434"]})]})]})]})]})})})]}):(0,_.jsx)("div",{className:"flex items-center space-x-2 ".concat(d),children:(0,_.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,_.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(m.connected?"bg-green-500 animate-pulse":"bg-red-500")}),(0,_.jsx)("span",{className:"text-sm font-medium ".concat(m.connected?"text-green-600":"text-red-600"),children:m.connected?"\u041e\u043d\u043b\u0430\u0439\u043d":"\u041e\u0444\u043b\u0430\u0439\u043d"})]})})},Ie=e=>{let{notification:t,onClose:s}=e;return(0,_.jsx)("div",{className:"p-4 rounded-lg border shadow-lg ".concat((e=>{const t={success:"bg-green-50 border-green-200 text-green-800",error:"bg-red-50 border-red-200 text-red-800",warning:"bg-yellow-50 border-yellow-200 text-yellow-800",info:"bg-blue-50 border-blue-200 text-blue-800"};return t[e]||t.info})(t.type)),children:(0,_.jsxs)("div",{className:"flex items-start justify-between",children:[(0,_.jsxs)("div",{className:"flex-1",children:[(0,_.jsx)("h4",{className:"text-sm font-medium mb-1",children:t.title}),(0,_.jsx)("p",{className:"text-sm opacity-90",children:t.message}),t.actions&&(0,_.jsx)("div",{className:"flex space-x-2 mt-3",children:t.actions.map((e,t)=>(0,_.jsx)("button",{onClick:e.action,className:"px-3 py-1 text-xs font-medium rounded transition-colors ".concat(e.primary?"bg-blue-600 text-white hover:bg-blue-700":"bg-white border hover:bg-gray-50"),children:e.label},t))})]}),(0,_.jsx)("button",{onClick:s,className:"ml-3 text-gray-400 hover:text-gray-600 transition-colors",children:"\xd7"})]})})},De=e=>{let{websocket:t,isGenerating:s,generationStartTime:a,onStopGeneration:o,onReconnect:i,onForceReconnect:c,className:l=""}=e;const[d,m]=(0,n.useState)([]),[u,h]=(0,n.useState)(null),[x,g]=(0,n.useState)(null),p=(0,n.useRef)({}),y=(0,n.useRef)({}),b=(0,n.useCallback)(e=>{m(t=>t.filter(t=>t.id!==e))},[]),f=(0,n.useCallback)(e=>{const t="".concat(e.type,"_").concat(e.title,"_").concat(e.message),s=p.current[t],n=Date.now();if(s&&n-s<5e3)return null;y.current[t]&&clearTimeout(y.current[t]);const a=setTimeout(()=>{const s=Date.now()+Math.random(),a=(0,r.A)((0,r.A)({id:s,timestamp:Date.now(),autoHide:!0,duration:5e3},e),{},{key:t});m(s=>[...s.filter(s=>!(s.key===t&&s.type===e.type)),a]),p.current[t]=n,a.autoHide&&setTimeout(()=>{b(s)},a.duration)},"error"===e.type?500:100);return y.current[t]=a,t},[b]);(0,n.useEffect)(()=>()=>{Object.values(y.current).forEach(e=>{e&&clearTimeout(e)})},[]),(0,n.useEffect)(()=>{if(!t)return;let e=null,s=null,r=null,n=0;const a=t=>{r!==t&&(r=t,e&&clearTimeout(e),e=setTimeout(()=>{switch(t){case"connected":h(null),n=0,m(e=>e.filter(e=>!("error"===e.type&&"\u041e\u0448\u0438\u0431\u043a\u0430 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f"===e.title))),f({type:"success",title:"\u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043e",message:"\u0421\u0432\u044f\u0437\u044c \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0430",duration:3e3});break;case"reconnecting":f({type:"info",title:"\u041f\u0435\u0440\u0435\u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435",message:"\u041f\u043e\u043f\u044b\u0442\u043a\u0430 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c...",autoHide:!1});break;case"failed":if(n++,n<=3){h({code:1006,message:"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \u043a \u0441\u0435\u0440\u0432\u0435\u0440\u0443"}),m(e=>e.filter(e=>!("error"===e.type&&"\u041e\u0448\u0438\u0431\u043a\u0430 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f"===e.title))),f({type:"error",title:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f",message:"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \u043a \u0441\u0435\u0440\u0432\u0435\u0440\u0443. \u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u0438\u043d\u0442\u0435\u0440\u043d\u0435\u0442-\u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435.",autoHide:!1,actions:[{label:"\u041f\u0435\u0440\u0435\u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c",action:c||i,primary:!0}]})}}},300))},o=e=>{console.error("WebSocket error:",e),s&&clearTimeout(s),s=setTimeout(()=>{let t={type:"error",title:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f",message:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0440\u0430\u0431\u043e\u0442\u0435 \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c",autoHide:!1};1008===e.code&&(t={type:"error",title:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438",message:"\u0412\u0430\u0448\u0430 \u0441\u0435\u0441\u0441\u0438\u044f \u0438\u0441\u0442\u0435\u043a\u043b\u0430. \u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0432\u043e\u0439\u0442\u0438 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0443 \u0437\u0430\u043d\u043e\u0432\u043e.",autoHide:!1,actions:[{label:"\u0412\u043e\u0439\u0442\u0438",action:()=>window.location.href="/login",primary:!0}]}),m(e=>e.filter(e=>!("error"===e.type&&e.title===t.title))),f(t)},500)};return t.on("stateChange",a),t.on("error",o),()=>{e&&clearTimeout(e),s&&clearTimeout(s),t.off("stateChange",a),t.off("error",o)}},[t,f,i,c]);const v=(0,n.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return f((0,r.A)({type:"error",title:"\u041e\u0448\u0438\u0431\u043a\u0430",message:"string"===typeof e?e:e.message},t))},[f]),w=(0,n.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return f((0,r.A)({type:"success",title:"\u0423\u0441\u043f\u0435\u0448\u043d\u043e",message:e},t))},[f]),j=(0,n.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return f((0,r.A)({type:"info",title:"\u0418\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f",message:e},t))},[f]),N=(0,n.useCallback)(()=>(g({message:"\u041c\u043e\u0434\u0435\u043b\u044c \u0418\u0418 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0430"}),f({type:"warning",title:"\u041c\u043e\u0434\u0435\u043b\u044c \u0418\u0418 \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0430",message:"\u041c\u043e\u0434\u0435\u043b\u044c \u0438\u0441\u043a\u0443\u0441\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0433\u043e \u0438\u043d\u0442\u0435\u043b\u043b\u0435\u043a\u0442\u0430 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0430. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u043f\u043e\u0437\u0436\u0435.",autoHide:!1,actions:[{label:"\u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u044c",action:()=>window.location.reload(),primary:!0}]})),[f]);return(0,n.useEffect)(()=>(window.statusNotifications={showError:v,showSuccess:w,showInfo:j,showModelUnavailable:N,removeNotification:b},()=>{delete window.statusNotifications}),[v,w,j,N,b]),(0,_.jsxs)("div",{className:"fixed inset-0 pointer-events-none z-50 ".concat(l),children:[s&&(0,_.jsx)("div",{className:"absolute top-20 left-1/2 transform -translate-x-1/2 pointer-events-auto",children:(0,_.jsx)(Ee,{isGenerating:s,startTime:a,onStop:o,variant:"detailed"})}),(0,_.jsx)("div",{className:"absolute top-4 right-4 pointer-events-auto",children:(0,_.jsx)(Te,{websocket:t,onReconnect:i,onForceReconnect:c,showDetails:!1,autoHide:!0})}),(0,_.jsx)("div",{className:"absolute top-4 left-4 space-y-2 pointer-events-auto max-w-sm",children:(0,_.jsx)(Ce.N,{children:d.map(e=>(0,_.jsx)(Re.P.div,{initial:{opacity:0,x:-100,scale:.9},animate:{opacity:1,x:0,scale:1},exit:{opacity:0,x:-100,scale:.9},transition:{duration:.3},children:(0,_.jsx)(Ie,{notification:e,onClose:()=>b(e.id)})},e.id))})})]})},Pe=()=>{const[e,t]=(0,n.useState)([]),[s,N]=(0,n.useState)(""),[k,S]=(0,n.useState)(!1),[A,R]=(0,n.useState)(null),[C,E]=(0,n.useState)(null),[I,D]=(0,n.useState)([]),[P,W]=(0,n.useState)(!1),[M,L]=(0,n.useState)(!1),[z,F]=(0,n.useState)(!1),[U,q]=(0,n.useState)(!1),[Q,G]=(0,n.useState)(!1),[B,V]=(0,n.useState)("basic"),[J,K]=(0,n.useState)(null),Z=(0,n.useRef)(null),X=(0,n.useRef)(null),[Y,$]=(0,n.useState)(()=>{if("undefined"!==typeof window){return window.innerWidth<768}return!1}),[ee,te]=(0,n.useState)(!1);(0,n.useEffect)(()=>{if(ee){const e=setTimeout(()=>{te(!1)},1e3);return()=>clearTimeout(e)}},[ee]);const[se,re]=(0,n.useState)(null),ne=(0,n.useRef)(null),ae=(0,n.useRef)(null),oe=(0,n.useRef)(null),ie=(0,n.useRef)(!0),ce=(0,n.useRef)(null),le=(0,n.useRef)(!1),[de,me]=(0,n.useState)(""),{showGenerationStopped:ue,showError:he,showSuccess:xe}=w(),ge=()=>{const e=ae.current;e&&(e.scrollTop=e.scrollHeight)};let ye;const be=(0,n.useCallback)(e=>{if(!e||!e.content)return void console.warn("Received invalid message data:",e);const s={id:"ai_".concat(Date.now()),type:"ai",content:e.content,timestamp:(new Date).toISOString(),enhancements:e.enhancements||{}};t(e=>[...e,s]),S(!1)},[]),{isConnected:ve,connectionState:we,websocket:je,sendChatMessage:Ne,stopGeneration:ke,forceReconnect:Ae}=((e,t,s,a)=>{const{user:o}=(0,b.A)(),i=(0,n.useRef)(null),c=(0,n.useRef)(!1),l=(0,n.useRef)(null),[d,m]=(0,n.useState)(!1),[u,h]=(0,n.useState)("disconnected"),x=(0,n.useCallback)(()=>{if(!o)return null;const r=localStorage.getItem("token");if(!r)return null;l.current&&(l.current.disconnect(),l.current=null);const n=e?String(e).replace(/[^0-9]/g,""):null,i="wss://advacodex.com/ws";let c;c=n&&n.length>0?"".concat(i,"/session/").concat(n,"?token=").concat(r):"".concat(i,"/general?token=").concat(r),console.log("Creating ResilientWebSocket connection to:",c);try{const e=new f(c,{maxReconnectAttempts:10,reconnectDelay:1e3,maxReconnectDelay:3e4,pingInterval:3e4,pongTimeout:1e4});return l.current=e,e.on("open",()=>{console.log("ResilientWebSocket connected successfully"),m(!0)}),e.on("close",e=>{let{code:t,reason:s}=e;console.log("ResilientWebSocket closed:",t,s),m(!1)}),e.on("stateChange",e=>{console.log("ResilientWebSocket state changed:",e),h(e),m("connected"===e)}),e.on("message",e=>{if(console.log("ResilientWebSocket message received:",e),"pong"!==e.type)switch(e.type){case"new_message":null===t||void 0===t||t(e.data);break;case"typing":null===s||void 0===s||s(e.user_id,e.is_typing);break;case"session_update":null===a||void 0===a||a(e.data);break;case"generation_stopped":console.log("Generation stopped:",e.message);break;default:console.log("Unknown message type:",e.type)}else console.log("Pong received")}),e.on("error",e=>{console.error("ResilientWebSocket error:",e)}),e.connect().catch(e=>{console.error("Failed to connect ResilientWebSocket:",e)}),e}catch(d){return console.error("Failed to create ResilientWebSocket:",d),null}},[o,e,t,s,a]);(0,n.useEffect)(()=>(o&&void 0!==e&&x(),()=>{i.current&&clearTimeout(i.current),l.current&&(l.current.disconnect(),l.current=null)}),[o,e,x]);const g=(0,n.useCallback)(t=>{if(l.current){const s=(0,r.A)((0,r.A)({},t),{},{session_id:e});return l.current.send(s)}return console.warn("ResilientWebSocket not available, message queued"),!1},[e]),p=(0,n.useCallback)(e=>{c.current!==e&&(e?(c.current=!0,g({type:"typing",is_typing:!0}),clearTimeout(i.current),i.current=setTimeout(()=>{p(!1)},3e3)):(clearTimeout(i.current),i.current=setTimeout(()=>{c.current=!1,g({type:"typing",is_typing:!1})},300)))},[g]),y=(0,n.useCallback)(e=>{g({type:"join_session",session_id:e})},[g]),v=(0,n.useCallback)(e=>g({type:"new_message",content:e}),[g]),w=(0,n.useCallback)(()=>g({type:"stop_generation"}),[g]),j=(0,n.useCallback)(()=>{l.current&&l.current.isConnected?console.log("ResilientWebSocket already connected"):x()},[x]),N=(0,n.useCallback)(()=>{l.current&&(l.current.disconnect(),l.current=null),m(!1),h("disconnected")},[]),k=(0,n.useCallback)(()=>{l.current?l.current.reconnect():x()},[x]);return{isConnected:d,connectionState:u,websocket:l.current,sendTyping:p,joinSession:y,sendChatMessage:v,stopGeneration:w,connect:j,disconnect:N,forceReconnect:k}})(C,be);ye=(0,n.useCallback)(()=>{ce.current&&(ce.current.abort(),ce.current=null),ke&&ke(),S(!1),R(null),ue()},[ke]),(0,n.useEffect)(()=>{le.current||(le.current=!0,"serviceWorker"in navigator&&"caches"in window&&caches.keys().then(e=>{e.forEach(e=>{e.includes("advakod")&&(console.log("\u041e\u0447\u0438\u0449\u0430\u0435\u043c \u0441\u0442\u0430\u0440\u044b\u0439 \u043a\u0435\u0448:",e),caches.delete(e))})}).catch(e=>console.error("\u041e\u0448\u0438\u0431\u043a\u0430 \u043e\u0447\u0438\u0441\u0442\u043a\u0438 \u043a\u0435\u0448\u0430:",e)),t([{id:"welcome",type:"ai",content:"\u041f\u0440\u0438\u0432\u0435\u0442! \u042f \u0432\u0430\u0448 \u0410\u0434\u0432\u0430\u041a\u041e\u0414 AI-\u043f\u043e\u043c\u043e\u0449\u043d\u0438\u043a. \u0417\u0430\u0434\u0430\u0432\u0430\u0439\u0442\u0435 \u043b\u044e\u0431\u044b\u0435 \u0432\u043e\u043f\u0440\u043e\u0441\u044b \u043f\u043e \u0440\u043e\u0441\u0441\u0438\u0439\u0441\u043a\u043e\u043c\u0443 \u0437\u0430\u043a\u043e\u043d\u043e\u0434\u0430\u0442\u0435\u043b\u044c\u0441\u0442\u0432\u0443, \u0438 \u044f \u043f\u043e\u043c\u043e\u0433\u0443 \u0432\u0430\u043c \u0440\u0430\u0437\u043e\u0431\u0440\u0430\u0442\u044c\u0441\u044f. \u041c\u043e\u0436\u0435\u0442\u0435 \u0442\u0430\u043a\u0436\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0442\u044c \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u044b \u0434\u043b\u044f \u0430\u043d\u0430\u043b\u0438\u0437\u0430.",timestamp:(new Date).toISOString()}]))},[]),(0,n.useEffect)(()=>{console.log("useEffect sessionId \u0438\u0437\u043c\u0435\u043d\u0438\u043b\u0441\u044f:",C,"initialized:",le.current);(async()=>{if(le.current||C){if(!C)return console.log("\u041d\u0435\u0442 sessionId, \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u043c \u043f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435"),void t([{id:"welcome",type:"ai",content:"\u041f\u0440\u0438\u0432\u0435\u0442! \u042f \u0432\u0430\u0448 \u0410\u0434\u0432\u0430\u041a\u041e\u0414 AI-\u043f\u043e\u043c\u043e\u0449\u043d\u0438\u043a. \u0417\u0430\u0434\u0430\u0432\u0430\u0439\u0442\u0435 \u043b\u044e\u0431\u044b\u0435 \u0432\u043e\u043f\u0440\u043e\u0441\u044b \u043f\u043e \u0440\u043e\u0441\u0441\u0438\u0439\u0441\u043a\u043e\u043c\u0443 \u0437\u0430\u043a\u043e\u043d\u043e\u0434\u0430\u0442\u0435\u043b\u044c\u0441\u0442\u0432\u0443, \u0438 \u044f \u043f\u043e\u043c\u043e\u0433\u0443 \u0432\u0430\u043c \u0440\u0430\u0437\u043e\u0431\u0440\u0430\u0442\u044c\u0441\u044f. \u041c\u043e\u0436\u0435\u0442\u0435 \u0442\u0430\u043a\u0436\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0442\u044c \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u044b \u0434\u043b\u044f \u0430\u043d\u0430\u043b\u0438\u0437\u0430.",timestamp:(new Date).toISOString()}]);console.log("\ud83d\udd04 \u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u043b\u044f \u0441\u0435\u0441\u0441\u0438\u0438:",C);try{const s=(0,v.e9)("/chat/sessions/".concat(C,"/messages"));console.log("\ud83d\udce1 \u0417\u0430\u043f\u0440\u043e\u0441 \u043a API:",s);const r=(await H.A.get(s,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}})).data||[];console.log("\u2705 \u041f\u043e\u043b\u0443\u0447\u0435\u043d\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439:",r.length);try{var e;const t=await H.A.get((0,v.e9)("/chat/sessions/".concat(C)),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});null!==(e=t.data)&&void 0!==e&&e.chat_mode&&(V(t.data.chat_mode),console.log("\u2705 \u0417\u0430\u0433\u0440\u0443\u0436\u0435\u043d \u0440\u0435\u0436\u0438\u043c \u0447\u0430\u0442\u0430 \u0438\u0437 \u0441\u0435\u0441\u0441\u0438\u0438:",t.data.chat_mode))}catch(o){console.warn("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0440\u0435\u0436\u0438\u043c \u0447\u0430\u0442\u0430 \u0438\u0437 \u0441\u0435\u0441\u0441\u0438\u0438:",o)}const n=r.map(e=>({id:"msg_".concat(e.id),type:"user"===e.role?"user":"ai",content:e.content,timestamp:e.created_at,enhancements:e.enhancements||{}}));0===n.length?(console.log("\u26a0\ufe0f \u0421\u0435\u0441\u0441\u0438\u044f \u043f\u0443\u0441\u0442\u0430, \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u043c \u043f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435"),t([{id:"welcome",type:"ai",content:"\u041f\u0440\u0438\u0432\u0435\u0442! \u042f \u0432\u0430\u0448 \u0410\u0434\u0432\u0430\u041a\u041e\u0414 AI-\u043f\u043e\u043c\u043e\u0449\u043d\u0438\u043a. \u0417\u0430\u0434\u0430\u0432\u0430\u0439\u0442\u0435 \u043b\u044e\u0431\u044b\u0435 \u0432\u043e\u043f\u0440\u043e\u0441\u044b \u043f\u043e \u0440\u043e\u0441\u0441\u0438\u0439\u0441\u043a\u043e\u043c\u0443 \u0437\u0430\u043a\u043e\u043d\u043e\u0434\u0430\u0442\u0435\u043b\u044c\u0441\u0442\u0432\u0443, \u0438 \u044f \u043f\u043e\u043c\u043e\u0433\u0443 \u0432\u0430\u043c \u0440\u0430\u0437\u043e\u0431\u0440\u0430\u0442\u044c\u0441\u044f. \u041c\u043e\u0436\u0435\u0442\u0435 \u0442\u0430\u043a\u0436\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0442\u044c \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u044b \u0434\u043b\u044f \u0430\u043d\u0430\u043b\u0438\u0437\u0430.",timestamp:(new Date).toISOString()}])):(console.log("\u2705 \u0417\u0430\u0433\u0440\u0443\u0436\u0435\u043d\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439:",n.length),t(n)),setTimeout(()=>{ge(),ie.current=!0},100)}catch(i){var s,r,n,a;console.error("\u274c \u041e\u0448\u0438\u0431\u043a\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0441\u0435\u0441\u0441\u0438\u0438:",i),console.error("\u0414\u0435\u0442\u0430\u043b\u0438 \u043e\u0448\u0438\u0431\u043a\u0438:",(null===(s=i.response)||void 0===s?void 0:s.data)||i.message),console.error("\u0421\u0442\u0430\u0442\u0443\u0441:",null===(r=i.response)||void 0===r?void 0:r.status),re(i),t([{id:"error",type:"error",content:"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f: ".concat((null===(n=i.response)||void 0===n||null===(a=n.data)||void 0===a?void 0:a.detail)||i.message,". \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443."),timestamp:(new Date).toISOString()}])}}else console.log("\u041f\u0440\u043e\u043f\u0443\u0441\u043a \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 - \u043f\u0435\u0440\u0432\u0430\u044f \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f \u0431\u0435\u0437 sessionId")})()},[C]),(0,n.useEffect)(()=>{ie.current&&ge()},[e]),(0,n.useEffect)(()=>{if(e.length>0){const t=e[e.length-1];if("ai"===t.type){const e=t.content.substring(0,100);me("Assistant: ".concat(e).concat(t.content.length>100?"...":""))}}},[e]),(0,n.useEffect)(()=>{if(oe.current){oe.current.style.height="auto";const e=oe.current.scrollHeight;oe.current.style.height="".concat(Math.min(e,120),"px")}},[s]),(0,n.useEffect)(()=>{const e=()=>{if(window.visualViewport){window.visualViewport.height<.7*window.innerHeight&&ge()}};if(window.visualViewport)return window.visualViewport.addEventListener("resize",e),()=>window.visualViewport.removeEventListener("resize",e)},[]),(0,n.useEffect)(()=>{const e=()=>{window.innerWidth<768||Y||$(!0)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[Y]),(0,n.useEffect)(()=>{const e=window.innerWidth<768;if(!Y&&e)return document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}},[Y]),(0,n.useEffect)(()=>{const e=e=>{"Escape"===e.key&&!Y&&window.innerWidth<768&&$(!0)};if(!Y&&window.innerWidth<768)return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[Y]);const Re=function(e,t){const s=document.getElementById("mode-notification-overlay-direct");s&&s.remove();const r=document.documentElement.classList.contains("dark")||window.matchMedia("(prefers-color-scheme: dark)").matches||document.body.classList.contains("dark"),n=r?"#1f2937":"#ffffff",a=r?"#f9fafb":"#111827",o=r?"#374151":"#e5e7eb",i=r?"#9ca3af":"#6b7280",c='\n      <div id="mode-notification-overlay-direct" style="\n        position: fixed !important;\n        top: 0 !important;\n        left: 0 !important;\n        width: 100vw !important;\n        height: 100vh !important;\n        z-index: 9999999 !important;\n        display: flex !important;\n        align-items: center !important;\n        justify-content: center !important;\n        background-color: '.concat(r?"rgba(0, 0, 0, 0.7)":"rgba(0, 0, 0, 0.5)",' !important;\n        pointer-events: auto !important;\n      ">\n        <div style="\n          background-color: ').concat(n," !important;\n          color: ").concat(a," !important;\n          padding: 24px 32px !important;\n          border-radius: 12px !important;\n          border: 1px solid ").concat(o,' !important;\n          box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.1) !important;\n          min-width: 380px !important;\n          max-width: 520px !important;\n          display: flex !important;\n          flex-direction: column !important;\n          gap: 12px !important;\n          pointer-events: auto !important;\n        ">\n          <div style="display: flex; align-items: center; gap: 16px;">\n            <div style="\n              width: 40px;\n              height: 40px;\n              border-radius: 50%;\n              background-color: ').concat(r?"#374151":"#f3f4f6",';\n              display: flex;\n              align-items: center;\n              justify-content: center;\n              flex-shrink: 0;\n            ">\n              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <path d="M10 2L3 7V17H8V12H12V17H17V7L10 2Z" fill="').concat(r?"#60a5fa":"#3b82f6",'" />\n              </svg>\n            </div>\n            <div style="flex: 1;">\n              <p style="\n                margin: 0;\n                font-size: 16px;\n                font-weight: 600;\n                line-height: 1.5;\n                color: ').concat(a,';\n              ">').concat(e,"</p>\n              ").concat(t?'<p style="\n                margin: 4px 0 0 0;\n                font-size: 13px;\n                font-weight: 400;\n                line-height: 1.4;\n                color: '.concat(r?"#9ca3af":"#6b7280",';\n              ">').concat(t,"</p>"):"",'\n            </div>\n            <button onclick="this.closest(\'#mode-notification-overlay-direct\').remove()" style="\n              background: none !important;\n              border: none !important;\n              color: ').concat(i,' !important;\n              cursor: pointer !important;\n              padding: 4px !important;\n              font-size: 20px !important;\n              display: flex;\n              align-items: center;\n              justify-content: center;\n              flex-shrink: 0;\n            " aria-label="\u0417\u0430\u043a\u0440\u044b\u0442\u044c">\u2715</button>\n          </div>\n        </div>\n      </div>\n    ');document.body.insertAdjacentHTML("beforeend",c),setTimeout(()=>{const e=document.getElementById("mode-notification-overlay-direct");e&&e.remove()},3e3)},Ce=async e=>{if(e===B)return void G(!1);const t="basic"===e?"\u041f\u0440\u043e\u0441\u0442\u043e\u0439 \u0438 \u043f\u043e\u043d\u044f\u0442\u043d\u044b\u0439 \u0440\u0435\u0436\u0438\u043c \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439":"\u041f\u0440\u043e\u0444\u0435\u0441\u0441\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u044b\u0439 \u0440\u0435\u0436\u0438\u043c \u0441 \u044e\u0440\u0438\u0434\u0438\u0447\u0435\u0441\u043a\u0438\u043c\u0438 \u0442\u0435\u0440\u043c\u0438\u043d\u0430\u043c\u0438";Re("\u0420\u0435\u0436\u0438\u043c \u0438\u0437\u043c\u0435\u043d\u0435\u043d \u043d\u0430: ".concat("basic"===e?"\u0411\u0430\u0437\u043e\u0432\u044b\u0439":"\u042d\u043a\u0441\u043f\u0435\u0440\u0442"),t,"success");const s=C?parseInt(C.toString().replace(/[^0-9]/g,"")):null;if(!s)return V(e),void G(!1);try{(await H.A.patch((0,v.e9)("/chat/sessions/".concat(s,"/mode")),null,{params:{chat_mode:e},headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}})).data&&(V(e),G(!1))}catch(r){console.error("\u041e\u0448\u0438\u0431\u043a\u0430 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0440\u0435\u0436\u0438\u043c\u0430:",r),Re("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0440\u0435\u0436\u0438\u043c \u0447\u0430\u0442\u0430","\u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0435 \u0440\u0430\u0437","error")}},_e=async()=>{const e=s.trim();if(!e||k)return;const n=C?parseInt(C.toString().replace(/[^0-9]/g,"")):null,a={id:"msg_".concat(Date.now()),type:"user",content:e,timestamp:(new Date).toISOString(),files:I};t(e=>[...e,a]),N(""),D([]),S(!0),R(Date.now()),re(null);try{const s={message:e,session_id:n,set_chat_mode:B};console.log("\u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f:",{message:e.substring(0,50),sessionId:n,url:(0,v.e9)("/chat/message")});const a=(0,v.e9)("/chat/message/stream"),o=new AbortController;ce.current=o;const c=localStorage.getItem("token"),l=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Accept:"text/event-stream","Cache-Control":"no-cache",Authorization:c?"Bearer ".concat(c):""},cache:"no-store",body:JSON.stringify(s),signal:o.signal});if(!l.ok||!l.body){const e=await l.text().catch(()=>"");throw new Error("Streaming request failed: ".concat(l.status," ").concat(e))}const d="ai_".concat(Date.now());t(e=>[...e,{id:d,type:"ai",content:"",timestamp:(new Date).toISOString()}]);const m=l.body.getReader(),u=new TextDecoder("utf-8");let h="";const x=e=>{t(t=>t.map(t=>t.id===d?(0,r.A)((0,r.A)({},t),{},{content:(t.content||"")+e}):t))};for(;;){const{value:e,done:t}=await m.read();if(t)break;h+=u.decode(e,{stream:!0});const s=h.split(/\n\n/);h=s.pop()||"";for(const r of s){const e=r.split("\n").find(e=>e.startsWith("data:"));if(!e)continue;const t=e.replace(/^data:\s?/,"");try{const e=JSON.parse(t);if("start"===e.type&&e.session_id)console.log("\u041f\u043e\u043b\u0443\u0447\u0435\u043d session_id \u043e\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430:",e.session_id,"\u0442\u0435\u043a\u0443\u0449\u0438\u0439:",C),C&&C===e.session_id||(E(e.session_id),console.log("\u2705 sessionId \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d:",e.session_id));else if("chunk"===e.type&&"string"===typeof e.content)x(e.content);else if("end"===e.type);else if("error"===e.type)throw new Error(e.content||"stream error")}catch(i){x(t)}}}S(!1),R(null)}catch(c){var o;console.error("\u041e\u0448\u0438\u0431\u043a\u0430 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f:",c);const e=ce.current&&(null===(o=ce.current.signal)||void 0===o?void 0:o.aborted)||"AbortError"===(null===c||void 0===c?void 0:c.name)||String((null===c||void 0===c?void 0:c.message)||c).toLowerCase().includes("aborted");if(S(!1),R(null),e)return void ue();re(c),console.error("\u041e\u0448\u0438\u0431\u043a\u0430 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f:",c),e||he(c,{autoHide:!1,actions:[{label:"\u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u044c",action:()=>_e(),primary:!0}]});let s="\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f.";const r=String((null===c||void 0===c?void 0:c.message)||c||"").toLowerCase();if(r.includes("timeout")||r.includes("[timeout]"))s="\u041f\u0440\u0435\u0432\u044b\u0448\u0435\u043d\u043e \u0432\u0440\u0435\u043c\u044f \u043e\u0436\u0438\u0434\u0430\u043d\u0438\u044f \u043e\u0442\u0432\u0435\u0442\u0430 (300 \u0441\u0435\u043a\u0443\u043d\u0434). \u041c\u043e\u0434\u0435\u043b\u044c \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u0434\u043e\u043b\u044c\u0448\u0435 \u043e\u0431\u044b\u0447\u043d\u043e\u0433\u043e. \u0420\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0430\u0446\u0438\u0438:\n\u2022 \u0423\u043f\u0440\u043e\u0441\u0442\u0438\u0442\u0435 \u0432\u043e\u043f\u0440\u043e\u0441\n\u2022 \u0420\u0430\u0437\u0431\u0435\u0439\u0442\u0435 \u0441\u043b\u043e\u0436\u043d\u044b\u0439 \u0432\u043e\u043f\u0440\u043e\u0441 \u043d\u0430 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043f\u0440\u043e\u0441\u0442\u044b\u0445\n\u2022 \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u043f\u043e\u0437\u0436\u0435, \u043a\u043e\u0433\u0434\u0430 \u043d\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440 \u0431\u0443\u0434\u0435\u0442 \u043c\u0435\u043d\u044c\u0448\u0435";else if(c.response){const e=c.response.status,t=c.response.data;408===e?s="\u041f\u0440\u0435\u0432\u044b\u0448\u0435\u043d\u043e \u0432\u0440\u0435\u043c\u044f \u043e\u0436\u0438\u0434\u0430\u043d\u0438\u044f \u043e\u0442\u0432\u0435\u0442\u0430. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0443\u043f\u0440\u043e\u0441\u0442\u0438\u0442\u044c \u0432\u043e\u043f\u0440\u043e\u0441 \u0438\u043b\u0438 \u0440\u0430\u0437\u0431\u0438\u0442\u044c \u0435\u0433\u043e \u043d\u0430 \u0447\u0430\u0441\u0442\u0438.":503===e?s="\u0421\u0435\u0440\u0432\u0435\u0440 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e \u043f\u0435\u0440\u0435\u0433\u0440\u0443\u0436\u0435\u043d. \u041f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435 \u043d\u0435\u043c\u043d\u043e\u0433\u043e \u0438 \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0441\u043d\u043e\u0432\u0430.":401===e?s="\u041e\u0448\u0438\u0431\u043a\u0430 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438. \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u043e\u0439\u0434\u0438\u0442\u0435 \u0441\u043d\u043e\u0432\u0430.":429===e?s="\u0421\u043b\u0438\u0448\u043a\u043e\u043c \u043c\u043d\u043e\u0433\u043e \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432. \u041f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435 \u043d\u0435\u043c\u043d\u043e\u0433\u043e \u043f\u0435\u0440\u0435\u0434 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u043c \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u043c.":e>=500?s="\u041e\u0448\u0438\u0431\u043a\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430. \u041c\u044b \u0443\u0436\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u043c \u043d\u0430\u0434 \u0435\u0451 \u0443\u0441\u0442\u0440\u0430\u043d\u0435\u043d\u0438\u0435\u043c.":(null!==t&&void 0!==t&&t.detail||null!==t&&void 0!==t&&t.message)&&(s=t.detail||t.message)}else c.request&&(s="\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u043e\u0435\u0434\u0438\u043d\u0438\u0442\u044c\u0441\u044f \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c. \u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u043a \u0438\u043d\u0442\u0435\u0440\u043d\u0435\u0442\u0443.");const n={id:"error_".concat(Date.now()),type:"error",content:s,timestamp:(new Date).toISOString(),error:c};t(e=>[...e,n])}};return(0,n.useEffect)(()=>{const e=e=>{if(window.innerWidth>=768&&U){e.target.closest("[data-input-area]")||q(!1)}};if(U&&window.innerWidth>=768)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[U]),(0,n.useEffect)(()=>{const e=e=>{X.current&&!X.current.contains(e.target)&&G(!1)};if(Q)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[Q]),(0,_.jsxs)("div",{className:"flex h-full bg-gray-50 dark:bg-gray-900 overflow-x-hidden",children:[(0,_.jsx)("div",{className:"hidden md:flex md:flex-col md:h-full ".concat(Y?"w-16":"w-80"," transition-all duration-300 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex-shrink-0 overflow-hidden"),children:(0,_.jsx)(O,{isCollapsed:Y,onToggle:()=>{$(!Y),te(!1)},onToggleCollapse:()=>{$(!Y),te(!1)},currentSessionId:C,onSessionSelect:e=>{console.log("onSessionSelect \u0432\u044b\u0437\u0432\u0430\u043d \u0441 id:",e,"\u0422\u0435\u043a\u0443\u0449\u0438\u0439 sessionId:",C),E(e)},onNewChat:e=>{E(e)},focusSearch:ee})}),!Y&&(0,_.jsxs)("div",{className:"md:hidden fixed inset-0 z-[60] flex",style:{zIndex:60},children:[(0,_.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity duration-300",onClick:e=>{e.preventDefault(),e.stopPropagation(),$(!0)}}),(0,_.jsxs)("div",{className:"relative w-full max-w-[320px] bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 transform transition-transform duration-300 ease-out z-[61] shadow-2xl",onClick:e=>e.stopPropagation(),style:{zIndex:61},children:[(0,_.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between bg-white dark:bg-gray-800",children:[(0,_.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"\u0418\u0441\u0442\u043e\u0440\u0438\u044f \u0447\u0430\u0442\u043e\u0432"}),(0,_.jsx)("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),$(!0)},className:"p-3 min-h-[44px] min-w-[44px] text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-all flex items-center justify-center touch-manipulation shadow-sm hover:shadow-md flex-shrink-0","aria-label":"\u0417\u0430\u043a\u0440\u044b\u0442\u044c \u0438\u0441\u0442\u043e\u0440\u0438\u044e",title:"\u0417\u0430\u043a\u0440\u044b\u0442\u044c \u0438\u0441\u0442\u043e\u0440\u0438\u044e",type:"button",children:(0,_.jsx)(a.A,{className:"w-6 h-6"})})]}),(0,_.jsx)(O,{isCollapsed:!1,hideHeader:!0,onToggle:()=>{$(!0),te(!1)},onToggleCollapse:()=>{$(!0),te(!1)},currentSessionId:C,onSessionSelect:e=>{console.log("onSessionSelect (\u043c\u043e\u0431\u0438\u043b\u044c\u043d\u0430\u044f \u0432\u0435\u0440\u0441\u0438\u044f) \u0432\u044b\u0437\u0432\u0430\u043d \u0441 id:",e,"\u0422\u0435\u043a\u0443\u0449\u0438\u0439 sessionId:",C),E(e),$(!0),te(!1)},onNewChat:e=>{E(e),$(!0),te(!1)},focusSearch:ee})]})]}),(0,_.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden overflow-x-hidden min-w-0 max-w-full",children:[(0,_.jsx)("div",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 sm:px-6 py-4 flex-shrink-0",children:(0,_.jsxs)("div",{className:"flex items-center justify-between",children:[(0,_.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,_.jsx)("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),$(e=>!e)},className:"md:hidden p-2.5 min-w-[44px] min-h-[44px] text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-all flex items-center justify-center touch-manipulation shadow-sm hover:shadow-md","aria-label":"\u0418\u0441\u0442\u043e\u0440\u0438\u044f \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432",title:"\u0418\u0441\u0442\u043e\u0440\u0438\u044f \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432",type:"button",children:(0,_.jsx)(o.A,{className:"w-5 h-5"})}),(0,_.jsx)("div",{className:"w-10 h-10 bg-blue-600 dark:bg-primary-500 rounded-full flex items-center justify-center neon-glow-purple",children:(0,_.jsx)(i.A,{className:"w-6 h-6 text-white"})}),(0,_.jsxs)("div",{children:[(0,_.jsx)("h1",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100",children:"\u0427\u0430\u0442 \u0441 \u0410\u0414\u0412\u0410\u041a\u041e\u0414"}),(0,_.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1 hidden sm:block",children:"\u0412\u0430\u0448 \u043f\u0435\u0440\u0441\u043e\u043d\u0430\u043b\u044c\u043d\u044b\u0439 AI \u044e\u0440\u0438\u0441\u0442-\u043a\u043e\u043d\u0441\u0443\u043b\u044c\u0442\u0430\u043d\u0442"})]})]}),(0,_.jsx)("div",{className:"flex items-center space-x-2",children:!ve&&"failed"===we&&(0,_.jsxs)("button",{onClick:Ae,className:"flex items-center space-x-1 px-3 py-1 text-sm bg-blue-600 dark:bg-primary-600 text-white rounded-lg hover:bg-blue-700 dark:hover:bg-primary-700 transition-colors neon-button-primary",title:"\u041f\u0435\u0440\u0435\u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \u043a \u0441\u0435\u0440\u0432\u0435\u0440\u0443",children:[(0,_.jsx)(c.A,{className:"w-4 h-4"}),(0,_.jsx)("span",{className:"hidden sm:inline",children:"\u041f\u0435\u0440\u0435\u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c"})]})})]})}),(0,_.jsxs)("div",{className:"flex-1 overflow-y-auto overflow-x-hidden p-3 sm:p-6 space-y-4 dark:bg-gray-900 min-h-0",ref:ae,onScroll:()=>{ie.current=(()=>{const e=ae.current;return!e||e.scrollHeight-e.scrollTop-e.clientHeight<=120})()},role:"log","aria-live":"polite","aria-label":"Chat messages",children:[e.map(t=>(0,_.jsx)("div",{className:"flex ".concat("user"===t.type?"justify-end":"justify-start"),children:(0,_.jsx)("div",{className:"".concat("user"===t.type?"max-w-[85%] md:max-w-[80%] ml-auto":"w-full"),children:(0,_.jsxs)("div",{className:"flex items-start space-x-3 ".concat("user"===t.type?"flex-row-reverse space-x-reverse":""),children:[(0,_.jsx)("div",{className:"w-[35px] h-[35px] md:w-10 md:h-10 rounded-full flex items-center justify-center ".concat("user"===t.type?"bg-blue-600 dark:bg-primary-600 neon-glow-cyan":"bg-gray-600 dark:bg-gray-700 neon-glow-purple"),children:"user"===t.type?(0,_.jsx)(l.A,{className:"w-[18px] h-[18px] md:w-5 md:h-5 text-white"}):(0,_.jsx)(i.A,{className:"w-[18px] h-[18px] md:w-5 md:h-5 text-white"})}),(0,_.jsx)("div",{className:"".concat("user"===t.type?"px-4 py-3 rounded-lg bg-blue-600 dark:bg-primary-600 text-white neon-card":"error"===t.type?"":"px-4 py-3 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border border-gray-200 dark:border-gray-700 neon-glass-card"),children:"error"===t.type?(0,_.jsx)(Se,{error:t.error||t.content,onRetry:()=>{const t=e.slice().reverse().find(e=>"user"===e.type);t&&N(t.content)},onReconnect:Ae,variant:"default"}):(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(pe,{message:t}),(0,_.jsxs)("div",{className:"flex items-center justify-between mt-3",children:[(0,_.jsx)("div",{className:"text-xs opacity-70",children:new Date(t.timestamp).toLocaleTimeString()}),"ai"===t.type&&"welcome"===t.id&&(0,_.jsx)(fe,{messageId:t.id})]})]})})]})})},t.id)),k&&(0,_.jsx)("div",{className:"flex justify-start",children:(0,_.jsx)("div",{className:"w-full",children:(0,_.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,_.jsx)("div",{className:"w-[35px] h-[35px] md:w-10 md:h-10 rounded-full bg-gray-600 flex items-center justify-center",children:(0,_.jsx)(i.A,{className:"w-[18px] h-[18px] md:w-5 md:h-5 text-white"})}),(0,_.jsx)("div",{className:"flex-1",children:(0,_.jsx)(Ee,{isGenerating:k,startTime:A,onStop:ye,variant:"default",estimatedTime:120})})]})})}),(0,_.jsx)("div",{ref:ne})]}),(0,_.jsxs)("div",{ref:Z,"data-input-area":!0,className:"bg-transparent p-3 sm:p-4 md:p-6 flex-shrink-0 z-40 transition-all duration-300 safe-bottom",style:{paddingBottom:"max(12px, env(safe-area-inset-bottom, 0px))"},onMouseEnter:()=>{window.innerWidth>=768&&q(!0)},onMouseLeave:()=>{window.innerWidth>=768&&q(!1)},onTouchStart:()=>{window.innerWidth<768&&q(!0)},children:[(0,_.jsx)("style",{children:"\n            #chat-input-textarea {\n              text-align: left;\n            }\n            #chat-input-textarea::placeholder {\n              text-align: left;\n            }\n          "}),I.length>0&&(0,_.jsx)("div",{className:"mb-3 flex flex-wrap gap-2",children:I.map((e,t)=>(0,_.jsxs)("div",{className:"flex items-center space-x-2 bg-gray-100 dark:bg-gray-700 px-3 py-2 rounded-xl",children:[(0,_.jsx)(d.A,{className:"w-4 h-4 text-gray-600 dark:text-gray-300"}),(0,_.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:e.name}),(0,_.jsx)("button",{onClick:()=>D(e=>e.filter((e,s)=>s!==t)),className:"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200",children:(0,_.jsx)(m.A,{className:"w-4 h-4"})})]},t))}),U&&(0,_.jsxs)("div",{className:"flex items-center gap-2 mb-3 animate-slide-in-up overflow-x-auto -mx-3 sm:-mx-4 px-3 sm:px-4",children:[(0,_.jsxs)("button",{onClick:()=>W(!P),className:"flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 hover:bg-primary-50 dark:hover:bg-primary-900/20 rounded-xl transition-all min-h-[44px] touch-manipulation flex-shrink-0 whitespace-nowrap",title:"\u041f\u0440\u0438\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0444\u0430\u0439\u043b","aria-label":"Attach file",children:[(0,_.jsx)(u.A,{className:"w-4 h-4 flex-shrink-0"}),(0,_.jsx)("span",{className:"hidden sm:inline",children:"\u0424\u0430\u0439\u043b\u044b"})]}),(0,_.jsxs)("button",{onClick:()=>L(!M),className:"flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 hover:bg-primary-50 dark:hover:bg-primary-900/20 rounded-xl transition-all min-h-[44px] touch-manipulation flex-shrink-0 whitespace-nowrap",title:"\u0428\u0430\u0431\u043b\u043e\u043d\u044b \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432","aria-label":"Question templates",children:[(0,_.jsx)(h.A,{className:"w-4 h-4 flex-shrink-0"}),(0,_.jsx)("span",{className:"hidden sm:inline",children:"\u0428\u0430\u0431\u043b\u043e\u043d\u044b"})]})]}),(0,_.jsxs)("div",{className:"flex items-center gap-2 sm:gap-3",children:[(0,_.jsxs)("div",{className:"relative",ref:X,children:[(0,_.jsx)("button",{onClick:()=>G(!Q),className:"h-[48px] w-[48px] sm:h-[52px] sm:w-[52px] bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-600 hover:text-primary-600 dark:hover:text-primary-400 rounded-xl transition-all flex items-center justify-center touch-manipulation shadow-md hover:shadow-lg flex-shrink-0 border border-gray-200 dark:border-gray-600",title:"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0440\u0435\u0436\u0438\u043c\u0430","aria-label":"Mode settings",children:(0,_.jsx)(x.A,{className:"w-5 h-5 sm:w-6 sm:h-6"})}),Q&&(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)("div",{className:"fixed inset-0 z-40",onClick:()=>G(!1)}),(0,_.jsxs)("div",{className:"absolute bottom-full left-0 mb-2 w-72 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 py-2 z-50",onClick:e=>e.stopPropagation(),children:[(0,_.jsx)("div",{className:"px-4 py-2 border-b border-gray-200 dark:border-gray-700",children:(0,_.jsx)("h3",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:"\u0420\u0435\u0436\u0438\u043c \u0447\u0430\u0442\u0430"})}),(0,_.jsx)("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),Ce("basic").catch(e=>console.error("\u041e\u0448\u0438\u0431\u043a\u0430:",e))},className:"w-full px-4 py-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:(0,_.jsx)("div",{className:"flex items-center justify-between",children:(0,_.jsxs)("div",{className:"flex-1",children:[(0,_.jsxs)("div",{className:"flex items-center gap-2",children:[(0,_.jsx)("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:"\u0411\u0430\u0437\u043e\u0432\u044b\u0439"}),"basic"===B&&(0,_.jsx)(g.A,{className:"w-4 h-4 text-primary-600 dark:text-primary-400"})]}),(0,_.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"\u041f\u0440\u043e\u0441\u0442\u043e\u0439 \u0438 \u043f\u043e\u043d\u044f\u0442\u043d\u044b\u0439 \u0440\u0435\u0436\u0438\u043c \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439, \u0431\u0435\u0437 \u0441\u043b\u043e\u0436\u043d\u044b\u0445 \u0442\u0435\u0440\u043c\u0438\u043d\u043e\u0432."})]})})}),(0,_.jsx)("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),Ce("expert").catch(e=>console.error("\u041e\u0448\u0438\u0431\u043a\u0430:",e))},className:"w-full px-4 py-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors border-t border-gray-200 dark:border-gray-700",children:(0,_.jsx)("div",{className:"flex items-center justify-between",children:(0,_.jsxs)("div",{className:"flex-1",children:[(0,_.jsxs)("div",{className:"flex items-center gap-2",children:[(0,_.jsx)("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:"\u042d\u043a\u0441\u043f\u0435\u0440\u0442"}),"expert"===B&&(0,_.jsx)(g.A,{className:"w-4 h-4 text-primary-600 dark:text-primary-400"})]}),(0,_.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"\u041f\u0440\u043e\u0434\u0432\u0438\u043d\u0443\u0442\u044b\u0439 \u0440\u0435\u0436\u0438\u043c \u0441 \u043f\u0440\u043e\u0444\u0435\u0441\u0441\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u044b\u043c\u0438 \u0442\u0435\u0440\u043c\u0438\u043d\u0430\u043c\u0438 \u0434\u043b\u044f \u043e\u043f\u044b\u0442\u043d\u044b\u0445 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439"})]})})})]})]})]}),(0,_.jsxs)("div",{className:"flex-1 relative min-w-0",children:[(0,_.jsx)("div",{className:"\n                  rounded-3xl\n                  border-[3px] sm:border-[4px]\n                  border-primary-500 dark:border-primary-600\n                  bg-white dark:bg-gray-700\n                  backdrop-blur-xl\n                  transition-all duration-300\n                  flex items-center\n                  ".concat(U?"shadow-[0_0_30px_rgba(37,99,235,0.5),0_10px_40px_rgba(0,0,0,0.3)] border-primary-600 dark:border-primary-500 ring-4 ring-primary-500/20 dark:ring-primary-600/20":"shadow-[0_4px_20px_rgba(0,0,0,0.15),0_8px_30px_rgba(0,0,0,0.1)] border-primary-500 dark:border-primary-600","\n                "),style:{height:"48px",minHeight:"48px"},children:(0,_.jsx)("textarea",{ref:oe,id:"chat-input-textarea",value:s,onChange:e=>N(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),_e())},onFocus:()=>{q(!0)},onTouchStart:()=>{q(!0)},onBlur:e=>{if(window.innerWidth>=768){const t=e.relatedTarget;t&&t.closest("[data-input-area]")||setTimeout(()=>{document.activeElement!==oe.current&&q(!1)},200)}},placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0432\u0430\u0448 \u0432\u043e\u043f\u0440\u043e\u0441...",className:" w-full px-3 sm:px-4 bg-transparent text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 text-base transition-all duration-300 focus:outline-none focus:ring-0 resize-none leading-normal border-0 overflow-hidden ",style:{height:"100%",paddingTop:"10px",paddingBottom:"10px",lineHeight:"20px",verticalAlign:"middle",maxHeight:"48px"},rows:1,disabled:k,"aria-label":"Type your message","aria-describedby":"input-help"})}),(0,_.jsx)("span",{id:"input-help",className:"sr-only",children:"Press Enter to send, Shift+Enter for new line"})]}),(0,_.jsx)("button",{onClick:()=>F(!z),className:"h-[48px] w-[48px] sm:h-[52px] sm:w-[52px] bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-600 hover:text-primary-600 dark:hover:text-primary-400 rounded-xl transition-all flex items-center justify-center touch-manipulation shadow-md hover:shadow-lg flex-shrink-0 border border-gray-200 dark:border-gray-600",title:"\u0413\u043e\u043b\u043e\u0441\u043e\u0432\u043e\u0439 \u0432\u0432\u043e\u0434","aria-label":"Voice input",children:(0,_.jsx)(p.A,{className:"w-5 h-5 sm:w-6 sm:h-6"})}),s.trim()&&(0,_.jsx)("button",{onClick:_e,disabled:!s.trim()||k,className:"h-[48px] w-[48px] sm:h-[52px] sm:w-[52px] p-2.5 sm:p-3 bg-primary-600 text-white rounded-xl hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center shadow-lg touch-manipulation flex-shrink-0",title:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435","aria-label":"Send message",children:(0,_.jsx)(y.A,{className:"w-5 h-5"})})]})]})]}),P&&(0,_.jsx)(j.wl,{onClose:()=>W(!1),onFilesSelected:e=>D(t=>[...t,...e])}),M&&(0,_.jsx)(j.uH,{isVisible:M,onClose:()=>L(!1),onTemplateSelect:e=>{N(e),L(!1)}}),z&&(0,_.jsx)(T,{onClose:()=>F(!1),onRecordingComplete:e=>{console.log("Audio recorded:",e)}}),(0,_.jsx)(De,{websocket:je,isGenerating:!1,generationStartTime:A,onStopGeneration:ye,onReconnect:Ae,onForceReconnect:Ae}),(0,_.jsx)("div",{role:"status","aria-live":"polite","aria-atomic":"true",className:"sr-only",children:de})]})}}}]);
//# sourceMappingURL=578.d7a14bbc.chunk.js.map
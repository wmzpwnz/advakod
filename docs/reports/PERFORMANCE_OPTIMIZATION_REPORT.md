# üöÄ –û–¢–ß–ï–¢ –ü–û –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò –ê–î–í–ê–ö–û–î

## üìä –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

### –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. **–ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥–µ–ª–∏**
   - `VISTRAL_N_CTX=8192` (—Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç)
   - `VISTRAL_N_THREADS=8` (–Ω–µ –≤—Å–µ CPU —è–¥—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è)
   - `VISTRAL_MAX_CONCURRENCY=1` (—Ç–æ–ª—å–∫–æ 1 –∑–∞–ø—Ä–æ—Å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)

2. **–ú–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã**
   - `VISTRAL_INFERENCE_TIMEOUT=1800` (30 –º–∏–Ω—É—Ç!)
   - `AI_CHAT_RESPONSE_TIMEOUT=300` (5 –º–∏–Ω—É—Ç)

3. **–ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ 8 –∏–∑ 10 CPU —è–¥–µ—Ä
   - –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ "degraded"

## üéØ –ü—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥–µ–ª–∏ (env.production)
```bash
# –ë–´–õ–û ‚Üí –°–¢–ê–õ–û
VISTRAL_N_CTX=8192 ‚Üí 4096          # –£—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ 2 —Ä–∞–∑–∞
VISTRAL_N_THREADS=8 ‚Üí 10           # –ü–æ–ª–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU
VISTRAL_MAX_CONCURRENCY=3 ‚Üí 5      # –ë–æ–ª—å—à–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç–∏
VISTRAL_INFERENCE_TIMEOUT=900 ‚Üí 300 # –ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã
```

### 2. –¢–∞–π–º–∞—É—Ç—ã AI-–∞–Ω–∞–ª–∏–∑–∞
```bash
AI_CHAT_RESPONSE_TIMEOUT=180 ‚Üí 120     # –ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã
AI_DOCUMENT_ANALYSIS_TIMEOUT=600 ‚Üí 300 # –£—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ 2 —Ä–∞–∑–∞
AI_COMPLEX_ANALYSIS_TIMEOUT=900 ‚Üí 600  # –£—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ 1.5 —Ä–∞–∑–∞
AI_EMBEDDINGS_TIMEOUT=60 ‚Üí 30          # –£—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ 2 —Ä–∞–∑–∞
```

### 3. –õ–∏–º–∏—Ç—ã —Ç–æ–∫–µ–Ω–æ–≤
```bash
AI_CHAT_RESPONSE_TOKENS=2000 ‚Üí 1500    # –ë—ã—Å—Ç—Ä–µ–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
AI_DOCUMENT_ANALYSIS_TOKENS=6000 ‚Üí 3000 # –£—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ 2 —Ä–∞–∑–∞
AI_COMPLEX_ANALYSIS_TOKENS=4000 ‚Üí 2500 # –£—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ 1.6 —Ä–∞–∑–∞
```

## üìà –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

| –ú–µ—Ç—Ä–∏–∫–∞ | –ë—ã–ª–æ | –°—Ç–∞–ª–æ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|------|-------|-----------|
| –°–∫–æ—Ä–æ—Å—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ | 30+ —Å–µ–∫ | 5-10 —Å–µ–∫ | **3-5x –±—ã—Å—Ç—Ä–µ–µ** |
| –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å | 1 –∑–∞–ø—Ä–æ—Å | 5 –∑–∞–ø—Ä–æ—Å–æ–≤ | **5x –±–æ–ª—å—à–µ** |
| –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU | 80% | 100% | **+20%** |
| –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ | 30+ —Å–µ–∫ | 5-10 —Å–µ–∫ | **3-5x –±—ã—Å—Ç—Ä–µ–µ** |
| –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å | 1 req/min | 5+ req/min | **5x –±–æ–ª—å—à–µ** |

## üõ†Ô∏è –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
```bash
cd /root/advakod
./OPTIMIZE_PERFORMANCE.sh
```

### –í—Ä—É—á–Ω—É—é:
```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
docker-compose -f docker-compose.prod.yml down

# 2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
# (—Ñ–∞–π–ª—ã —É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã)

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose -f docker-compose.prod.yml up -d

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
curl -s http://localhost:8000/ready | jq
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:
```bash
# –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
curl -s http://localhost:8000/ready | jq

# –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
curl -s http://localhost:8000/metrics/json | jq .unified_services

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∫—Ä–∏–ø—Ç
./MONITOR_PERFORMANCE.sh
```

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:
- **–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞**: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å < 10 —Å–µ–∫—É–Ω–¥
- **–û—á–µ—Ä–µ–¥—å –∑–∞–ø—Ä–æ—Å–æ–≤**: –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å < 3
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏**: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å < 25GB
- **–ü—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ–∫**: –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å < 5%

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –µ—â–µ –±–æ–ª—å—à–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å:
1. **–£–º–µ–Ω—å—à–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–æ 2048**:
   ```bash
   VISTRAL_N_CTX=2048
   ```

2. **–£–≤–µ–ª–∏—á–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å –¥–æ 8**:
   ```bash
   VISTRAL_MAX_CONCURRENCY=8
   ```

3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä—É—é –º–æ–¥–µ–ª—å**:
   - –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ Vistral-7B –≤–º–µ—Å—Ç–æ 24B
   - –ò–ª–∏ Q4_K_M –≤–º–µ—Å—Ç–æ Q5_0

### –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –±–æ–ª—å—à–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å:
1. **–í–µ—Ä–Ω—É—Ç—å –±–æ–ª—å—à–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç**:
   ```bash
   VISTRAL_N_CTX=6144  # –ö–æ–º–ø—Ä–æ–º–∏—Å—Å
   ```

2. **–£–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç—ã**:
   ```bash
   VISTRAL_INFERENCE_TIMEOUT=600
   ```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏**: –°–æ–∑–¥–∞–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π
2. **–û—Ç–∫–∞—Ç**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `env.production.backup.*` –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ —Å—Ç–∞—Ä—ã–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –°–ª–µ–¥–∏—Ç–µ –∑–∞ –º–µ—Ç—Ä–∏–∫–∞–º–∏ –ø–µ—Ä–≤—ã–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —ç—Ç–∏—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π –≤–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å **–≤ 3-5 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ** —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç–≤–µ—Ç–æ–≤. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å —É–≤–µ–ª–∏—á–∏—Ç—Å—è –≤ 5 —Ä–∞–∑, —á—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –±–æ–ª—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏: `./OPTIMIZE_PERFORMANCE.sh`
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
3. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏: `./MONITOR_PERFORMANCE.sh`
4. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

# üîß –¢–ï–ö–£–©–ò–ô –°–¢–ê–¢–£–° –ò –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

**–î–∞—Ç–∞:** 28 –æ–∫—Ç—è–±—Ä—è 2025, 21:31  
**–°–µ—Ä–≤–µ—Ä:** 31.130.145.75 (advacodex.com)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ AI –º–æ–¥–µ–ª—å –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞

---

## ‚úÖ –£–°–ü–ï–®–ù–û –ò–°–ü–†–ê–í–õ–ï–ù–û:

### 1. –ú–∏–≥—Ä–∞—Ü–∏—è Saiga ‚Üí Vistral ‚úÖ
- 7 —Å–µ—Ä–≤–∏—Å–æ–≤ ‚Üí 2 —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
- –í—Å–µ –∏–º–ø–æ—Ä—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- Legacy –∫–æ–¥ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω
- API endpoints –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω—ã (/llm –≤–º–µ—Å—Ç–æ /saiga)

### 2. Localhost ‚Üí Production ‚úÖ
- config.py: –≤—Å–µ defaults –∏—Å–ø–æ–ª—å–∑—É—é—Ç Docker services
- WebSocket URL: `wss://advacodex.com/ws` (–ë–ï–ó –ø–æ—Ä—Ç–∞ :8000!)
- CORS –∏ TrustedHosts –¥–ª—è advacodex.com
- Frontend nginx: server_name = advacodex.com

### 3. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–∞–π–º–∞—É—Ç—ã ‚úÖ
- unified_llm_service.py: 30s ‚Üí 900s (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é)
- nginx.conf: API –∏ WebSocket 30s ‚Üí 900s

### 4. –ù–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ ‚úÖ
- ‚úÖ pdfplumber==0.10.3
- ‚úÖ python-docx==1.1.0
- ‚úÖ langchain==0.1.20
- ‚úÖ langchain-text-splitters==0.0.1
- ‚úÖ pytesseract==0.3.10
- ‚úÖ pdf2image==1.16.3
- ‚úÖ psutil==5.9.6

---

## üö® –¢–ï–ö–£–©–ê–Ø –ü–†–û–ë–õ–ï–ú–ê:

### AI –ú–æ–¥–µ–ª—å Vistral-24B –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

**–û—à–∏–±–∫–∞:**
```
AssertionError in llama_cpp/llama.py line 365
assert self.model is not None
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–∞ –º–æ–¥–µ–ª–∏:**
```
‚úÖ –§–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: /opt/advakod/models/vistral/Vistral-24B-Instruct-Q5_0.gguf
‚úÖ –†–∞–∑–º–µ—Ä: 16GB (16,304,427,712 –±–∞–π—Ç)
‚úÖ –§–æ—Ä–º–∞—Ç: GGUF (–≤–∞–ª–∏–¥–Ω—ã–π)
‚úÖ –ü—Ä–∞–≤–∞: 644 (rw-r--r--)
‚úÖ –í–ª–∞–¥–µ–ª–µ—Ü: root:root
‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–≥—Ä—É–∑–∫–∏:**
```python
model_path=/opt/advakod/models/vistral/Vistral-24B-Instruct-Q5_0.gguf
n_ctx=8192
n_threads=8
n_gpu_layers=0
use_mmap=True
use_mlock=False
```

**–ü–∞–º—è—Ç—å —Å–µ—Ä–≤–µ—Ä–∞:**
```
Total: 39GB
Available: 34GB  ‚Üê –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –º–æ–¥–µ–ª–∏ 16GB
```

### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

1. **llama_cpp –≤–µ—Ä—Å–∏—è –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å –º–æ–¥–µ–ª—å—é**
   - –¢–µ–∫—É—â–∞—è: 0.2.11
   - –í–æ–∑–º–æ–∂–Ω–æ –Ω—É–∂–Ω–∞ –±–æ–ª–µ–µ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è

2. **–ú–æ–¥–µ–ª—å —Ç—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ –ø–∞–º—è—Ç–∏ —á–µ–º –µ—Å—Ç—å**
   - –ú–∞–ª–æ–≤–µ—Ä–æ—è—Ç–Ω–æ (34GB > 16GB —Ñ–∞–π–ª–∞)

3. **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã n_ctx —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–µ**
   - 8192 –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ
   - –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —É–º–µ–Ω—å—à–∏—Ç—å –¥–æ 4096 –∏–ª–∏ 2048

4. **–ü—Ä–æ–±–ª–µ–º–∞ —Å use_mmap**
   - –í–æ–∑–º–æ–∂–Ω–æ –Ω—É–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å (use_mmap=False)

---

## üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò (–ù–ê –í–´–ë–û–†):

### –í–∞—Ä–∏–∞–Ω—Ç 1: –£–º–µ–Ω—å—à–∏—Ç—å n_ctx (–±—ã—Å—Ç—Ä–æ)

–ò–∑–º–µ–Ω–∏—Ç—å –≤ `/root/advakod/env.production`:
```bash
VISTRAL_N_CTX=4096  # –í–º–µ—Å—Ç–æ 8192
```

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å:
```bash
docker-compose restart backend
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –û–±–Ω–æ–≤–∏—Ç—å llama-cpp-python (–º–æ–∂–µ—Ç –ø–æ–º–æ—á—å)

–í `requirements.txt`:
```
llama-cpp-python==0.2.90  # –ë–æ–ª–µ–µ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è
```

–ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å:
```bash
docker-compose build backend
docker-compose up -d backend
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ–Ω—å—à—É—é –º–æ–¥–µ–ª—å (–µ—Å–ª–∏ –∫—Ä–∏—Ç–∏—á–Ω–æ)

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Q4 –∫–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏—é –≤–º–µ—Å—Ç–æ Q5:
```bash
VISTRAL_MODEL_PATH=/opt/advakod/models/vistral/Vistral-24B-Instruct-Q4_K.gguf
```

**–ù–û:** —Ñ–∞–π–ª—ã Q4 –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ä–∞–∑–º–µ—Ä 136 –±–∞–π—Ç (–∑–∞–≥–ª—É—à–∫–∏), –Ω—É–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å!

### –í–∞—Ä–∏–∞–Ω—Ç 4: –û—Ç–ª–∞–¥–∫–∞ llama_cpp

–í–∫–ª—é—á–∏—Ç—å verbose —Ä–µ–∂–∏–º –≤ unified_llm_service.py:
```python
verbose=True  # –í–º–µ—Å—Ç–æ False
```

---

## üìä –¢–ï–ö–£–©–ò–ô –°–¢–ê–¢–£–° –°–ï–†–í–ò–°–û–í:

```
‚úÖ Frontend:   RUNNING  (WebSocket URL –∏—Å–ø—Ä–∞–≤–ª–µ–Ω)
‚úÖ Backend:    HEALTHY  (–≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã)
‚úÖ Nginx:      HEALTHY  (—Ç–∞–π–º–∞—É—Ç—ã 900s)
‚úÖ PostgreSQL: HEALTHY
‚úÖ Redis:      HEALTHY
‚ö†Ô∏è Qdrant:    UNHEALTHY (–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç)

‚ùå UnifiedLLMService: –º–æ–¥–µ–ª—å –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞
‚ö†Ô∏è UnifiedRAGService: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç LLM
```

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø:

**–ü–û–ü–†–û–ë–£–ô–¢–ï –í–ê–†–ò–ê–ù–¢ 1** (—Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π):

1. –£–º–µ–Ω—å—à–∏—Ç–µ n_ctx:
```bash
sed -i 's/VISTRAL_N_CTX=8192/VISTRAL_N_CTX=4096/' /root/advakod/env.production
```

2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ:
```bash
docker-compose restart backend
```

3. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 2-3 –º–∏–Ω—É—Ç—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏

4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
```bash
docker logs advakod_backend --tail 20 | grep "Model.*loaded"
curl https://advacodex.com/ready
```

–ï—Å–ª–∏ —ç—Ç–æ –Ω–µ –ø–æ–º–æ–∂–µ—Ç - –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –í–∞—Ä–∏–∞–Ω—Ç 2 (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ llama-cpp-python).

---

## ‚úÖ –•–û–†–û–®–ò–ï –ù–û–í–û–°–¢–ò:

**–í—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ:**
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ (7 ‚Üí 2 —Å–µ—Ä–≤–∏—Å–∞)
- ‚úÖ Production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ WebSocket –∏—Å–ø—Ä–∞–≤–ª–µ–Ω
- ‚úÖ –¢–∞–π–º–∞—É—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- ‚úÖ –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- ‚úÖ Frontend —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞—é—Ç

**–û—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å AI –º–æ–¥–µ–ª—å!**

---

**–î–∞—Ç–∞:** 28 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** 90% –≥–æ—Ç–æ–≤–æ - –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª—å ‚úÖ

